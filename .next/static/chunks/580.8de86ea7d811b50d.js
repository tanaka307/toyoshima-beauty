(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[580],{1673:(e,t,r)=>{var n=r(8304);t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;let r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,a=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(n++,"%c"===e&&(a=n))}),t.splice(a,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e},t.useColors=function(){let e;return"undefined"!=typeof window&&!!window.process&&("renderer"===window.process.type||!!window.process.__nwjs)||!("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(9630)(t);let{formatters:a}=e.exports;a.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},1870:(e,t,r)=>{"use strict";r.r(t),r.d(t,{applyPatch:()=>h,incremental:()=>n});var n={};r.r(n),r.d(n,{applyPatch:()=>f,getType:()=>y,rebaseValue:()=>function e(t,r){var n=y(t);if(n!==y(r))return r;var a=new l(t.endMeta),o=new l(r.endMeta);switch(n){case"object":for(var u=a.asObject(t),c=o.asObject(r),f=0,d=Object.keys(u.fields).length,h=Object.keys(c.fields).length,b=0,m=Object.entries(c.fields);b<m.length;b++){var v=m[b],g=v[0],w=v[1],k=u.fields[g];k&&(c.fields[g]=e(k,w),c.fields[g]===k&&f++)}return d===h&&d===f?t:r;case"array":var j=a.asArray(t),C=o.asArray(r);if(j.elements.length!==C.elements.length)break;for(var O=0,A=0;A<C.elements.length;A++)C.elements[A]=e(j.elements[A],C.elements[A]),C.elements[A]!==j.elements[A]&&O++;return 0===O?t:r;case"null":case"boolean":case"number":if(p(t)===p(r))return t;break;case"string":var E=p(t),S=p(r);if(E===S)return t;var F=o.copyString(null),x=function(e,t){for(var r=Math.min(e.length,t.length),n=0,a=0;a<r;){var o=e.codePointAt(a);if(o!==t.codePointAt(a))break;var s=i(o);n+=s,a+=4===s?2:1}return n}(E,S),_=function(e,t,r){void 0===r&&(r=0);for(var n=Math.min(e.length,t.length)-r,a=0,o=0;o<n;){var s=e.codePointAt(e.length-1-o);if(s!==t.codePointAt(t.length-1-o))break;var u=i(s);a+=u,o+=4===u?2:1}return a}(E,S,x),P=s(S),B=s(E);0<x&&o.stringAppendSlice(F,t,0,x),x<P-_&&o.stringAppendSlice(F,r,x,P-_),B-_<B&&o.stringAppendSlice(F,t,B-_,B);var M=o.finalize(F);if(p(M)!==S)throw Error("incorrect string rebase");return M}return r},unwrap:()=>p,wrap:()=>c});var a=["Value","Copy","Blank","ReturnIntoArray","ReturnIntoObject","ReturnIntoObjectSameKey","PushField","PushElement","PushParent","Pop","PushFieldCopy","PushFieldBlank","PushElementCopy","PushElementBlank","ReturnIntoObjectPop","ReturnIntoObjectSameKeyPop","ReturnIntoArrayPop","ObjectSetFieldValue","ObjectCopyField","ObjectDeleteField","ArrayAppendValue","ArrayAppendSlice","StringAppendString","StringAppendSlice"],o=function(){function e(e,t,r){this.i=0,this.inputStack=[],this.outputStack=[],this.model=e,this.root=t,this.patch=r}return e.prototype.read=function(){return this.patch[this.i++]},e.prototype.process=function(){for(this.inputStack.push({value:this.root}),this.outputStack.push({value:this.root});this.i<this.patch.length;){var e=this.read(),t=a[e];if(!t)throw Error("Unknown opcode: ".concat(e));this["process".concat(t)].apply(this)}var r=this.outputStack.pop();return this.finalizeOutput(r)},e.prototype.inputEntry=function(){return this.inputStack[this.inputStack.length-1]},e.prototype.inputKey=function(e,t){return e.keys||(e.keys=this.model.objectGetKeys(e.value).sort()),e.keys[t]},e.prototype.outputEntry=function(){return this.outputStack[this.outputStack.length-1]},e.prototype.outputArray=function(){var e=this.outputEntry();return e.writeValue||(e.writeValue=this.model.copyArray(e.value)),e.writeValue},e.prototype.outputObject=function(){var e=this.outputEntry();return e.writeValue||(e.writeValue=this.model.copyObject(e.value)),e.writeValue},e.prototype.outputString=function(){var e=this.outputEntry();return e.writeValue||(e.writeValue=this.model.copyString(e.value)),e.writeValue},e.prototype.finalizeOutput=function(e){return e.writeValue?this.model.finalize(e.writeValue):e.value},e.prototype.processValue=function(){var e=this.model.wrap(this.read());this.outputStack.push({value:e})},e.prototype.processCopy=function(){var e=this.inputEntry();this.outputStack.push({value:e.value})},e.prototype.processBlank=function(){this.outputStack.push({value:null})},e.prototype.processReturnIntoArray=function(){var e=this.outputStack.pop(),t=this.finalizeOutput(e),r=this.outputArray();this.model.arrayAppendValue(r,t)},e.prototype.processReturnIntoObject=function(){var e=this.read(),t=this.outputStack.pop(),r=this.finalizeOutput(t);r=this.model.markChanged(r);var n=this.outputObject();this.model.objectSetField(n,e,r)},e.prototype.processReturnIntoObjectSameKey=function(){var e=this.inputEntry(),t=this.outputStack.pop(),r=this.finalizeOutput(t),n=this.outputObject();this.model.objectSetField(n,e.key,r)},e.prototype.processPushField=function(){var e=this.read(),t=this.inputEntry(),r=this.inputKey(t,e),n=this.model.objectGetField(t.value,r);this.inputStack.push({value:n,key:r})},e.prototype.processPushElement=function(){var e=this.read(),t=this.inputEntry(),r=this.model.arrayGetElement(t.value,e);this.inputStack.push({value:r})},e.prototype.processPop=function(){this.inputStack.pop()},e.prototype.processPushFieldCopy=function(){this.processPushField(),this.processCopy()},e.prototype.processPushFieldBlank=function(){this.processPushField(),this.processBlank()},e.prototype.processPushElementCopy=function(){this.processPushElement(),this.processCopy()},e.prototype.processPushElementBlank=function(){this.processPushElement(),this.processBlank()},e.prototype.processReturnIntoObjectPop=function(){this.processReturnIntoObject(),this.processPop()},e.prototype.processReturnIntoObjectSameKeyPop=function(){this.processReturnIntoObjectSameKey(),this.processPop()},e.prototype.processReturnIntoArrayPop=function(){this.processReturnIntoArray(),this.processPop()},e.prototype.processObjectSetFieldValue=function(){this.processValue(),this.processReturnIntoObject()},e.prototype.processObjectCopyField=function(){this.processPushField(),this.processCopy(),this.processReturnIntoObjectSameKey(),this.processPop()},e.prototype.processObjectDeleteField=function(){var e=this.read(),t=this.inputEntry(),r=this.inputKey(t,e),n=this.outputObject();this.model.objectDeleteField(n,r)},e.prototype.processArrayAppendValue=function(){var e=this.model.wrap(this.read()),t=this.outputArray();this.model.arrayAppendValue(t,e)},e.prototype.processArrayAppendSlice=function(){var e=this.read(),t=this.read(),r=this.outputArray(),n=this.inputEntry().value;this.model.arrayAppendSlice(r,n,e,t)},e.prototype.processStringAppendString=function(){var e=this.model.wrap(this.read()),t=this.outputString();this.model.stringAppendValue(t,e)},e.prototype.processStringAppendSlice=function(){var e=this.read(),t=this.read(),r=this.outputString(),n=this.inputEntry().value;this.model.stringAppendSlice(r,n,e,t)},e}();function i(e){return e>>16?4:e>>11?3:e>>7?2:1}function s(e){for(var t=0,r=0;r<e.length;r++){var n=i(e.codePointAt(r));4==n&&r++,t+=n}return t}function u(e,t,r){void 0===r&&(r=0);var n=r,a=0;for(a=r;n<t;a++){var o=i(e.codePointAt(a));4===o&&a++,n+=o}return a}var l=function(){function e(e){this.meta=e}return e.prototype.wrap=function(e){return this.wrapWithMeta(e,this.meta,this.meta)},e.prototype.wrapWithMeta=function(e,t,r){return void 0===r&&(r=this.meta),{data:e,startMeta:t,endMeta:r}},e.prototype.asObject=function(e){if(!e.content){for(var t={},r=0,n=Object.entries(e.data);r<n.length;r++){var a=n[r],o=a[0],i=a[1];t[o]=this.wrapWithMeta(i,e.startMeta)}e.content={type:"object",fields:t}}return e.content},e.prototype.asArray=function(e){var t=this;if(!e.content){var r=e.data.map(function(r){return t.wrapWithMeta(r,e.startMeta)}),n=r.map(function(){return t.meta});e.content={type:"array",elements:r,metas:n}}return e.content},e.prototype.asString=function(e){if(!e.content){var t=e.data,r={value:t,utf8size:s(t),uses:[],startMeta:e.startMeta,endMeta:e.endMeta};e.content=this.stringFromParts([r])}return e.content},e.prototype.stringFromParts=function(e){for(var t={type:"string",parts:e},r=0;r<e.length;r++)e[r].uses.push(t);return t},e.prototype.objectGetKeys=function(e){return e.content?Object.keys(e.content.fields):Object.keys(e.data)},e.prototype.objectGetField=function(e,t){return this.asObject(e).fields[t]},e.prototype.arrayGetElement=function(e,t){return this.asArray(e).elements[t]},e.prototype.finalize=function(e){return this.updateEndMeta(e),{content:e,startMeta:this.meta,endMeta:this.meta}},e.prototype.markChanged=function(e){return this.wrap(p(e))},e.prototype.updateEndMeta=function(e){if("string"==e.type)for(var t=0,r=e.parts;t<r.length;t++)r[t].endMeta=this.meta;else if("array"===e.type)for(var n=0,a=e.elements;n<a.length;n++){var o=a[n];o.content&&o.endMeta!==this.meta&&this.updateEndMeta(o.content),o.endMeta=this.meta}else for(var i=0,s=Object.values(e.fields);i<s.length;i++){var o=s[i];o.content&&o.endMeta!==this.meta&&this.updateEndMeta(o.content),o.endMeta=this.meta}},e.prototype.copyString=function(e){if(!e)return{type:"string",parts:[]};var t=this.asString(e);return this.stringFromParts(t.parts.slice())},e.prototype.copyObject=function(e){var t={type:"object",fields:{}};if(e){var r=this.asObject(e);Object.assign(t.fields,r.fields)}return t},e.prototype.copyArray=function(e){var t=e?this.asArray(e):null;return{type:"array",elements:t?t.elements:[],metas:t?t.metas:[]}},e.prototype.objectSetField=function(e,t,r){e.fields[t]=r},e.prototype.objectDeleteField=function(e,t){delete e.fields[t]},e.prototype.arrayAppendValue=function(e,t){e.elements.push(t),e.metas.push(this.meta)},e.prototype.arrayAppendSlice=function(e,t,r,n){var a,o,i=this.asArray(t),s=i.elements.length===r;if((a=e.elements).push.apply(a,i.elements.slice(r,n)),s)(o=e.metas).push.apply(o,i.metas.slice(r,n));else for(var u=r;u<n;u++)e.metas.push(this.meta)},e.prototype.stringAppendValue=function(e,t){for(var r=this.asString(t),n=0,a=r.parts;n<a.length;n++){var o=a[n];this.stringAppendPart(e,o)}},e.prototype.stringAppendPart=function(e,t){e.parts.push(t),t.uses.push(e)},e.prototype.resolveStringPart=function(e,t,r){if(0===r)return t;for(var n=t;n<e.parts.length;n++){var a=e.parts[n];if(r===a.utf8size)return n+1;if(r<a.utf8size)return this.splitString(a,r),n+1;r-=a.utf8size}throw Error("splitting string out of bounds")},e.prototype.splitString=function(e,t){var r,n=t,a=e.utf8size-n;if(e.utf8size!==e.value.length){var o=0;for(t=0;o<n;t++){var s=i(e.value.codePointAt(t));4===s&&t++,o+=s}}r=e.value.slice(0,t);var u={value:e.value.slice(t),utf8size:a,uses:e.uses.slice(),startMeta:e.startMeta,endMeta:e.endMeta};e.value=r,e.utf8size=n;for(var l=0,c=e.uses;l<c.length;l++){var p=c[l],y=p.parts.indexOf(e);if(-1===y)throw Error("bug: mismatch between string parts and use.");p.parts.splice(y+1,0,u)}},e.prototype.stringAppendSlice=function(e,t,r,n){for(var a=this.asString(t),o=this.resolveStringPart(a,0,r),i=this.resolveStringPart(a,o,n-r),s=o;s<i;s++){var u=a.parts[s];this.stringAppendPart(e,u)}},e}();function c(e,t){return{data:e,startMeta:t,endMeta:t}}function p(e){if(void 0!==e.data)return e.data;var t,r=e.content;switch(r.type){case"string":t=r.parts.map(function(e){return e.value}).join("");break;case"array":t=r.elements.map(function(e){return p(e)});break;case"object":t={};for(var n=0,a=Object.entries(r.fields);n<a.length;n++){var o=a[n],i=o[0],s=o[1];t[i]=p(s)}}return e.data=t,t}function y(e){return e.content?e.content.type:Array.isArray(e.data)?"array":null===e.data?"null":typeof e.data}function f(e,t,r){return new o(new l(r),e,t).process()}var d={wrap:function(e){return e},finalize:function(e){return Array.isArray(e)?e:e.data},markChanged:function(e){return e},objectGetKeys:function(e){return Object.keys(e)},objectGetField:function(e,t){return e[t]},arrayGetElement:function(e,t){return e[t]},copyObject:function(e){var t={type:"object",data:{}};if(null!==e)for(var r=0,n=Object.entries(e);r<n.length;r++){var a=n[r],o=a[0],i=a[1];t.data[o]=i}return t},copyArray:function(e){return null===e?[]:e.slice()},copyString:function(e){return{type:"string",data:null===e?"":e}},objectSetField:function(e,t,r){e.data[t]=r},objectDeleteField:function(e,t){delete e.data[t]},arrayAppendValue:function(e,t){e.push(t)},arrayAppendSlice:function(e,t,r,n){e.push.apply(e,t.slice(r,n))},stringAppendSlice:function(e,t,r,n){var a=u(t,r),o=u(t,n,a);e.data+=t.slice(a,o)},stringAppendValue:function(e,t){e.data+=t}};function h(e,t){return new o(d,e,t).process()}},3139:e=>{function t(e,t,r,n){return Math.round(e/r)+" "+n+(t>=1.5*r?"s":"")}e.exports=function(e,r){r=r||{};var n,a,o,i,s=typeof e;if("string"===s&&e.length>0){var u=e;if(!((u=String(u)).length>100)){var l=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(l){var c=parseFloat(l[1]);switch((l[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*c;case"weeks":case"week":case"w":return 6048e5*c;case"days":case"day":case"d":return 864e5*c;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*c;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*c;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*c;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:break}}}return}if("number"===s&&isFinite(e)){return r.long?(a=Math.abs(n=e))>=864e5?t(n,a,864e5,"day"):a>=36e5?t(n,a,36e5,"hour"):a>=6e4?t(n,a,6e4,"minute"):a>=1e3?t(n,a,1e3,"second"):n+" ms":(i=Math.abs(o=e))>=864e5?Math.round(o/864e5)+"d":i>=36e5?Math.round(o/36e5)+"h":i>=6e4?Math.round(o/6e4)+"m":i>=1e3?Math.round(o/1e3)+"s":o+"ms"}throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},4349:e=>{"use strict";e.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;if(Array.isArray(t)){if((n=t.length)!=r.length)return!1;for(a=n;0!=a--;)if(!e(t[a],r[a]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((n=(o=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(a=n;0!=a--;)if(!Object.prototype.hasOwnProperty.call(r,o[a]))return!1;for(a=n;0!=a--;){var n,a,o,i=o[a];if(!e(t[i],r[i]))return!1}return!0}return t!=t&&r!=r}},4580:(e,t,r)=>{var n=r(2007),a=r(4349),o=r(5714),i=r(8239),s=r(1870);function u(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l=u(n),c=u(a);function p(){return(p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var y,f=function(e,t,r){"undefined"!=typeof window&&e.addEventListener===window.EventSource.prototype.addEventListener&&e.addEventListener(t,r,!1),e.addEventListener(t,r)};function d(e){return e._id.startsWith("drafts.")?e._id.slice(7):e._id}function h(e,t){var r=p({},e);return delete r._rev,s.applyPatch(r,t)}function b(){return Promise.resolve()}function m(e,t,r){if(!e.s){if(r instanceof v){if(!r.s)return void(r.o=m.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(m.bind(null,e,t),m.bind(null,e,2));e.s=t,e.v=r;let n=e.o;n&&n(e)}}var v=function(){function e(){}return e.prototype.then=function(t,r){var n=new e,a=this.s;if(a){var o=1&a?t:r;if(o){try{m(n,1,o(this.v))}catch(e){m(n,2,e)}return n}return this}return this.o=function(e){try{var a=e.v;1&e.s?m(n,1,t?t(a):a):r?m(n,1,r(a)):m(n,2,a)}catch(e){m(n,2,e)}},n},e}();function g(e){return e instanceof v&&1&e.s}var w=function(e){var t=e.projectId,r=e.dataset,n=e.token,a=e.documentLimit;try{return Promise.resolve(fetch("https://"+t+".api.sanity.io/v1/data/export/"+r,{credentials:"include",headers:n?{Authorization:"Bearer "+n}:void 0})).then(function(e){function t(t){var r,n,o=(function(e){if(!e)throw Error("Failed to read body from response");var t,r=!1;function n(){r=!0,t&&t.cancel()}return new ReadableStream({start:function(a){t=e.getReader();var o=new TextDecoder,i="";t.read().then(function e(s){try{if(s.done)return r||(0===(i=i.trim()).length||a.enqueue(JSON.parse(i)),a.close()),Promise.resolve();for(var u=(i+=o.decode(s.value,{stream:!0})).split("\n"),l=0;l<u.length-1;++l){var c=u[l].trim();if(0!==c.length)try{a.enqueue(JSON.parse(c))}catch(e){return a.error(e),n(),Promise.resolve()}}if(i=u[u.length-1],!t)return Promise.resolve();var p=function(r,n){try{var a=Promise.resolve(t.read()).then(function(t){e(t)})}catch(e){return n(e)}return a&&a.then?a.then(void 0,n):a}(0,function(e){a.error(e)});return Promise.resolve(p&&p.then?p.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}).catch(function(e){return a.error(e)})},cancel:n})})(e.body).getReader(),i=[],s=function(e,t){do{var r,n=e();if(n&&n.then){if(!g(n)){r=!0;break}n=n.v}var a=t();if(g(a)&&(a=a.v),!a)return n}while(!a.then);var o=new v,i=m.bind(null,o,2);return(r?n.then(s):a.then(u)).then(void 0,i),o;function s(r){for(n=r;g(a=t())&&(a=a.v),a;){if(a.then)return void a.then(u).then(void 0,i);if((n=e())&&n.then){if(!g(n))return void n.then(s).then(void 0,i);n=n.v}}m(o,1,n)}function u(r){if(r){do{if((n=e())&&n.then){if(!g(n))return void n.then(s).then(void 0,i);n=n.v}if(g(r=t())&&(r=r.v),!r)return void m(o,1,n)}while(!r.then);r.then(u).then(void 0,i)}else m(o,1,n)}}(function(){return Promise.resolve(o.read()).then(function(e){var t;if((t=n=(r=e).value)&&"error"in t&&"object"==typeof t.error&&null!==t.error&&"description"in t.error&&"string"==typeof t.error.description&&!("_id"in t))throw Error("Error streaming dataset: "+n.error);if(n&&!n._id.startsWith("_.")&&i.push(n),a&&i.length>a)throw o.cancel("Reached document limit"),Error("Error streaming dataset: Reached limit of "+a+" documents")})},function(){return!r.done});return s&&s.then?s.then(function(e){return i}):i}var r=function(){if(200!==e.status)return Promise.resolve(e.json()).then(function(e){throw Error("Error streaming dataset: "+("object"==typeof e&&"error"in e&&"message"in e?e.message||e.error:"<unknown error>"))})}();return r&&r.then?r.then(t):t()})}catch(e){return Promise.reject(e)}};Object.defineProperty(t,"groq",{enumerable:!0,get:function(){return l.default}}),t.groqStore=function(e){var t=["EventSource","ReadableStream","fetch"].filter(function(e){return!(e in window)});if(t.length>0)throw Error("Browser not supported. Missing browser APIs: "+t.join(", "));var r,n=null!=(r=e.EventSource)?r:window.EventSource;if(e.token&&n===window.EventSource)throw Error("When`token` option is used, `EventSource` option must also be provided. EventSource cannot be `window.EventSource`, as it does not support passing a token.");return function(e,t){var r,n=function(e,t){return Promise.resolve(a()).then(function(){var r=i.parse(e,{params:t});return Promise.resolve(i.evaluate(r,{dataset:s,params:t})).then(function(e){return e.get()})})},a=function(){try{return r||(r=function(e,t,r){var n,a,o,i,s=r.getDocuments,u=r.EventSource,l=e.projectId,c=e.dataset,y=e.overlayDrafts,m=e.documentLimit,v=e.token;if(!e.listen)return{unsubscribe:b,loaded:s({projectId:l,dataset:c,documentLimit:m,token:v}).then(F).then(b)};var g,w,k,j,C,O,A=new Map,E=[],S=new Promise(function(e,t){w=e,k=t});return{unsubscribe:(n={next:function(e){var t;g?(function(e){if(e.effects&&!e.documentId.startsWith("_.")){var t,r,n,a,o,i=A.get(e.documentId)||null;t=e.documentId,r=h(i,e.effects.apply),n=A.get(t),a=g||[],o=n?a.indexOf(n):-1,-1===o&&r?(a.push(r),A.set(t,r)):r?(a.splice(o,1,r),A.set(t,r)):(a.splice(o,1),A.delete(t))}}(e),t=g,clearTimeout(O),C!==e.transactionId&&j?(F(j),C=void 0):(C=e.transactionId,j=t.slice()),O=setTimeout(F,25,t.slice())):E.push(e)},open:function(){try{return Promise.resolve(s({projectId:l,dataset:c,documentLimit:m,token:v})).then(function(e){var t;(t=new Map,E.forEach(function(e){var r=t.get(e.documentId)||[];r.push(e),t.set(e.documentId,r)}),t.forEach(function(t,r){var n=e.find(function(e){return e._id===r});if(n){var a=!1,o=n;t.forEach(function(e){(a=a||e.previousRev===n._rev)&&e.effects&&(o=h(o,e.effects.apply))}),e.splice(e.indexOf(n),1,o)}else console.warn("Received mutation for missing document %s",r)}),g=e).forEach(function(e){return A.set(e._id,e)}),F(g),w()})}catch(e){return Promise.reject(e)}},error:function(e){return k(e)}},o=e.token,i=new u("https://"+e.projectId+".api.sanity.io/v1/data/listen/"+e.dataset+"?query=*&effectFormat=mendoza",{withCredentials:!0,headers:o?{Authorization:"Bearer "+o}:void 0}),f(i,"welcome",n.open),f(i,"mutation",(a=n.next,function(e){var t;try{t=JSON.parse(e.data)}catch(e){return}a(t)})),f(i,"channelError",function(e){var t;i.close();try{t=JSON.parse(e.data)}catch(e){return void n.error(Error("Unknown error parsing listener message"))}n.error(Error(t.message||t.error||"Listener returned HTTP "+t.statusCode))}),f(i,"error",function(e){var t="undefined"!=typeof window&&window.location.origin,r="object"==typeof e&&null!==e&&"message"in e?" ("+e.message+")":"";n.error(Error("Error establishing listener - check that the project ID and dataset are correct"+(t?", and that the CORS-origin ("+t+") is allowed":"")+r))}),{unsubscribe:function(){return Promise.resolve(i.close())}}).unsubscribe,loaded:S};function F(e){var r;j=void 0,O=void 0,C=void 0,t(y?(r=new Map,e.forEach(function(e){var t=r.get(d(e));e._id.startsWith("drafts.")?r.set(d(e),p({},e,{_id:d(e)})):t||r.set(e._id,e)}),Array.from(r.values())):e)}}(e,function(e){s=e,u()},t)),Promise.resolve(r.loaded).then(function(){})}catch(e){return Promise.reject(e)}},s=[],u=o.throttle(e.subscriptionThrottleMs||50,function(){m.forEach(v)}),m=[];function v(e){return n(e.query,e.params).then(function(t){"previousResult"in e&&c.default(e.previousResult,t)||(e.previousResult=t,e.callback(void 0,t))}).catch(function(t){e.callback(t)})}return{query:n,getDocument:function(e){return Promise.resolve(a()).then(function(){var t,r;return n(l.default(y||(t=["*[_id == $id][0]"],r||(r=t.slice(0)),t.raw=r,y=t)),{id:e})})},getDocuments:function(e){return Promise.resolve(a()).then(function(){return n("["+e.map(function(e){return'*[_id == "'+e+'"][0]'}).join(",\n")+"]")})},subscribe:function(t,r,n){if(!e.listen)throw Error("Cannot use `subscribe()` without `listen: true`");var a={query:t,params:r,callback:n};m.push(a);var o=!1;return v(a),{unsubscribe:function(){return o||(o=!0,m.splice(m.indexOf(a),1)),Promise.resolve()}}},close:function(){return u.cancel(),r?r.unsubscribe():Promise.resolve()}}}(e,{EventSource:n,getDocuments:w})}},5714:(e,t)=>{"use strict";function r(e,t,r){var n,a=r||{},o=a.noTrailing,i=void 0!==o&&o,s=a.noLeading,u=void 0!==s&&s,l=a.debounceMode,c=void 0===l?void 0:l,p=!1,y=0;function f(){n&&clearTimeout(n)}function d(){for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];var s=this,l=Date.now()-y;function d(){y=Date.now(),t.apply(s,a)}function h(){n=void 0}!p&&(u||!c||n||d(),f(),void 0===c&&l>e?u?(y=Date.now(),i||(n=setTimeout(c?h:d,e))):d():!0!==i&&(n=setTimeout(c?h:d,void 0===c?e-l:e)))}return d.cancel=function(e){var t=(e||{}).upcomingOnly;f(),p=!(void 0!==t&&t)},d}Object.defineProperty(t,"__esModule",{value:!0}),t.debounce=function(e,t,n){var a=(n||{}).atBegin;return r(e,t,{debounceMode:!1!==(void 0!==a&&a)})},t.throttle=r},5804:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}(r(1673));class a{pattern;patternRe;constructor(e){this.pattern=e,this.patternRe=function(e){let t=[];for(let r of e.split("."))"*"===r?t.push("[^.]+"):"**"===r?t.push(".*"):t.push(r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"));return RegExp(`^${t.join(".")}$`)}(e)}matches(e){return this.patternRe.test(e)}toJSON(){return this.pattern}}class o{type="stream";generator;ticker;isDone;data;constructor(e){this.generator=e,this.ticker=null,this.isDone=!1,this.data=[]}isArray(){return!0}async get(){let e=[];for await(let t of this)e.push(await t.get());return e}async *[Symbol.asyncIterator](){let e=0;for(;;){for(;e<this.data.length;e++)yield this.data[e];if(this.isDone)return;await this._nextTick()}}_nextTick(){let e;if(this.ticker)return this.ticker;let t=()=>{this.ticker=new Promise(t=>{e=t})},r=()=>{e(),t()},n=async()=>{for await(let e of this.generator())this.data.push(e),r();this.isDone=!0,r()};return t(),n(),this.ticker}}let i=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?(Z|([-+]\d{2}:\d{2}))$/;function s(e,t){let r=e.toString();for(;r.length<t;)r=`0${r}`;return r}class u{data;type;constructor(e,t){this.data=e,this.type=t}isArray(){return"array"===this.type}async get(){return this.data}[Symbol.asyncIterator](){if(Array.isArray(this.data))return function*(e){for(let t of e)yield b(t)}(this.data);throw Error(`Cannot iterate over: ${this.type}`)}}let l=new u(null,"null"),c=new u(!0,"boolean"),p=new u(!1,"boolean");class y{date;constructor(e){this.date=e}static parseToValue(e){let t=i.test(e)?new Date(e):null;return t?new u(new y(t),"datetime"):l}equals(e){return this.date.getTime()==e.date.getTime()}add(e){let t=new Date(this.date.getTime());return t.setTime(t.getTime()+1e3*e),new y(t)}difference(e){return(this.date.getTime()-e.date.getTime())/1e3}compareTo(e){return this.date.getTime()-e.date.getTime()}toString(){return function(e){let t=s(e.getUTCFullYear(),4),r=s(e.getUTCMonth()+1,2),n=s(e.getUTCDate(),2),a=s(e.getUTCHours(),2),o=s(e.getUTCMinutes(),2),i=s(e.getUTCSeconds(),2),u="",l=e.getMilliseconds();return 0!=l&&(u=`.${s(l,3)}`),`${t}-${r}-${n}T${a}:${o}:${i}${u}Z`}(this.date)}toJSON(){return this.toString()}}function f(e){return Number.isFinite(e)?new u(e,"number"):l}function d(e){return new u(e,"string")}function h(e){return new u(e,"datetime")}function b(e){return e&&"function"==typeof e.next?new o(async function*(){for await(let t of e)yield b(t)}):null==e?l:new u(e,m(e))}function m(e){return null===e||typeof e>"u"?"null":Array.isArray(e)?"array":e instanceof a?"path":e instanceof y?"datetime":typeof e}function v(e,t){return"string"===e.type&&"string"===t.type||"boolean"===e.type&&"boolean"===t.type||"null"===e.type&&"null"===t.type||"number"===e.type&&"number"===t.type?e.data===t.data:"datetime"===e.type&&"datetime"===t.type&&e.data.equals(t.data)}let g=/([^!@#$%^&*(),\\/?";:{}|[\]+<>\s-])+/g,w=/([^!@#$%^&(),\\/?";:{}|[\]+<>\s-])+/g,k=/(\b\.+|\.+\b)/g;function j(e,t){return 0!==e.length&&0!==t.length&&t.every(t=>t(e))}function C(e){return e.replace(k,"").match(g)||[]}function O(e){return A(e).map(e=>t=>t.some(t=>e.test(t)))}function A(e){return(e.replace(k,"").match(w)||[]).map(e=>RegExp(`^${e.slice(0,1024).replace(/\*/g,".*")}$`,"i"))}async function E(e,t){if("string"===e.type)return t(e.data),!0;if(e.isArray()){let r=!0;for await(let n of e)"string"===n.type?t(n.data):r=!1;return r}return!1}let S={datetime:1,number:2,string:3,boolean:4};function F(e,t){let r=m(e);if(r!==m(t))return null;switch(r){case"number":case"boolean":return e-t;case"string":return e<t?-1:+(e>t);case"datetime":return e.compareTo(t);default:return null}}let x={"==":function(e,t){return v(e,t)?c:p},"!=":function(e,t){return v(e,t)?p:c},">":function(e,t){if("stream"===e.type||"stream"===t.type)return l;let r=F(e.data,t.data);return null===r?l:r>0?c:p},">=":function(e,t){if("stream"===e.type||"stream"===t.type)return l;let r=F(e.data,t.data);return null===r?l:r>=0?c:p},"<":function(e,t){if("stream"===e.type||"stream"===t.type)return l;let r=F(e.data,t.data);return null===r?l:r<0?c:p},"<=":function(e,t){if("stream"===e.type||"stream"===t.type)return l;let r=F(e.data,t.data);return null===r?l:r<=0?c:p},in:async function(e,t){if("path"===t.type)return"string"!==e.type?l:t.data.matches(e.data)?c:p;if(t.isArray()){for await(let r of t)if(v(e,r))return c;return p}return l},match:async function(e,t){let r=[],n=[];return await E(e,e=>{r=r.concat(C(e))}),await E(t,e=>{n=n.concat(O(e))})&&j(r,n)?c:p},"+":function(e,t){return"datetime"===e.type&&"number"===t.type?h(e.data.add(t.data)):"number"===e.type&&"number"===t.type?f(e.data+t.data):"string"===e.type&&"string"===t.type?d(e.data+t.data):"object"===e.type&&"object"===t.type?b({...e.data,...t.data}):"array"===e.type&&"array"===t.type?b(e.data.concat(t.data)):e.isArray()&&t.isArray()?new o(async function*(){for await(let t of e)yield t;for await(let e of t)yield e}):l},"-":function(e,t){return"datetime"===e.type&&"number"===t.type?h(e.data.add(-t.data)):"datetime"===e.type&&"datetime"===t.type?f(e.data.difference(t.data)):"number"===e.type&&"number"===t.type?f(e.data-t.data):l},"*":_((e,t)=>e*t),"/":_((e,t)=>e/t),"%":_((e,t)=>e%t),"**":_((e,t)=>Math.pow(e,t))};function _(e){return function(t,r){return"number"===t.type&&"number"===r.type?f(e(t.data,r.data)):l}}let P=class e{params;source;value;parent;context;isHidden=!1;constructor(e,t,r,n,a){this.params=e,this.source=t,this.value=r,this.context=n,this.parent=a}createNested(t){return this.isHidden?new e(this.params,this.source,t,this.context,this.parent):new e(this.params,this.source,t,this.context,this)}createHidden(e){let t=this.createNested(e);return t.isHidden=!0,t}};function B(e,t,r=B){return(0,T[e.type])(e,t,r)}function M(e,t){return"then"in e?e.then(t):t(e)}let T={This:(e,t)=>t.value,Selector(){throw Error("Selectors can not be evaluated")},Everything:(e,t)=>t.source,Parameter:({name:e},t)=>b(t.params[e]),Context({key:e},t){if("before"===e||"after"===e)return t.context[e]||l;throw Error(`unknown context key: ${e}`)},Parent({n:e},t){let r=t;for(let t=0;t<e;t++){if(!r.parent)return l;r=r.parent}return r.value},OpCall({op:e,left:t,right:r},n,a){let o=x[e];if(!o)throw Error(`Unknown operator: ${e}`);let i=a(t,n),s=a(r,n);return"then"in i||"then"in s?(async()=>o(await i,await s))():o(i,s)},async Select({alternatives:e,fallback:t},r,n){for(let t of e){let e=await n(t.condition,r);if("boolean"===e.type&&!0===e.data)return n(t.value,r)}return t?n(t,r):l},async InRange({base:e,left:t,right:r,isInclusive:n},a,o){let i=await o(e,a),s=await o(t,a),u=await o(r,a),y=F(await i.get(),await s.get());if(null===y)return l;let f=F(await i.get(),await u.get());return null===f?l:n?y>=0&&f<=0?c:p:y>=0&&f<0?c:p},async Filter({base:e,expr:t},r,n){let a=await n(e,r);return a.isArray()?new o(async function*(){for await(let e of a){let a=r.createNested(e),o=await n(t,a);"boolean"===o.type&&!0===o.data&&(yield e)}}):l},async Projection({base:e,expr:t},r,n){let a=await n(e,r);return"object"!==a.type?l:n(t,r.createNested(a))},FuncCall:({func:e,args:t},r,n)=>e(t,r,n),PipeFuncCall:async({func:e,base:t,args:r},n,a)=>e(await a(t,n),r,n,a),async AccessAttribute({base:e,name:t},r,n){let a=r.value;return e&&(a=await n(e,r)),"object"===a.type&&a.data.hasOwnProperty(t)?b(a.data[t]):l},async AccessElement({base:e,index:t},r,n){let a=await n(e,r);if(!a.isArray())return l;let o=await a.get(),i=t<0?t+o.length:t;return b(o[i])},async Slice({base:e,left:t,right:r,isInclusive:n},a,o){let i=await o(e,a);if(!i.isArray())return l;let s=await i.get(),u=t,c=r;return u<0&&(u=s.length+u),c<0&&(c=s.length+c),n&&c++,u<0&&(u=0),c<0&&(c=0),b(s.slice(u,c))},async Deref({base:e},t,r){let n=await r(e,t);if(!t.source.isArray()||"object"!==n.type)return l;let a=n.data._ref;if("string"!=typeof a)return l;if(t.context.dereference)return b(await t.context.dereference({_ref:a}));for await(let e of t.source)if("object"===e.type&&a===e.data._id)return e;return l},Value:({value:e})=>b(e),Group:({base:e},t,r)=>r(e,t),async Object({attributes:e},t,r){let n={};for(let a of e){let e=a.type;switch(a.type){case"ObjectAttributeValue":{let e=await r(a.value,t);n[a.name]=await e.get();break}case"ObjectConditionalSplat":{let e=await r(a.condition,t);if("boolean"!==e.type||!1===e.data)continue;let o=await r(a.value,t);"object"===o.type&&Object.assign(n,o.data);break}case"ObjectSplat":{let e=await r(a.value,t);"object"===e.type&&Object.assign(n,e.data);break}default:throw Error(`Unknown node type: ${e}`)}}return b(n)},Array:({elements:e},t,r)=>new o(async function*(){for(let n of e){let e=await r(n.value,t);if(n.isSplat){if(e.isArray())for await(let t of e)yield t}else yield e}}),Tuple(){throw Error("tuples can not be evaluated")},async Or({left:e,right:t},r,n){let a=await n(e,r),o=await n(t,r);return"boolean"===a.type&&!0===a.data||"boolean"===o.type&&!0===o.data?c:"boolean"!==a.type||"boolean"!==o.type?l:p},async And({left:e,right:t},r,n){let a=await n(e,r),o=await n(t,r);return"boolean"===a.type&&!1===a.data||"boolean"===o.type&&!1===o.data?p:"boolean"!==a.type||"boolean"!==o.type?l:c},async Not({base:e},t,r){let n=await r(e,t);return"boolean"!==n.type?l:n.data?p:c},Neg:({base:e},t,r)=>M(r(e,t),e=>"number"!==e.type?l:f(-e.data)),Pos:({base:e},t,r)=>M(r(e,t),e=>"number"!==e.type?l:f(e.data)),Asc:()=>l,Desc:()=>l,async ArrayCoerce({base:e},t,r){let n=await r(e,t);return n.isArray()?n:l},async Map({base:e,expr:t},r,n){let a=await n(e,r);return a.isArray()?new o(async function*(){for await(let e of a){let a=r.createHidden(e);yield await n(t,a)}}):l},async FlatMap({base:e,expr:t},r,n){let a=await n(e,r);return a.isArray()?new o(async function*(){for await(let e of a){let a=r.createHidden(e),o=await n(t,a);if(o.isArray())for await(let e of o)yield e;else yield o}}):l}},I=new P({},l,l,{timestamp:new Date(0),identity:"me",before:null,after:null},null);function $(e){return!function e(t){switch(t.type){case"Group":case"Pos":case"Neg":return e(t.base);case"Value":case"Parameter":return!0;case"OpCall":switch(t.op){case"+":case"-":case"*":case"/":case"%":case"**":return e(t.left)&&e(t.right);default:return!1}default:return!1}}(e)?null:function e(t){let r=B(t,I,e);if("then"in r)throw Error("BUG: constant evaluate should never return a promise");return r}(e)}async function N(e){if("object"===e.type)return V(e.data);if(e.isArray()){let t=await R(e);if(t.length>0)return t.join(`

`)}return null}async function R(e,t=[]){for await(let r of e)if("object"===r.type){let e=V(r.data);null!==e&&t.push(e)}else r.isArray()&&await R(r,t);return t}function V(e){if("string"!=typeof e._type)return null;let t=e.children;if(!Array.isArray(t))return null;let r="";for(let e of t)e&&"object"==typeof e&&"string"==typeof e._type&&"span"===e._type&&"string"==typeof e.text&&(r+=e.text);return r}async function D(e,t,r){if("OpCall"===e.type&&"match"===e.op)return z(e.left,e.right,t,r);if("FuncCall"===e.type&&"boost"===e.name){let n=await D(e.args[0],t,r),a=await r(e.args[1],t);return"number"===a.type&&n>0?n+a.data:0}switch(e.type){case"Or":return await D(e.left,t,r)+await D(e.right,t,r);case"And":{let n=await D(e.left,t,r),a=await D(e.right,t,r);return 0===n||0===a?0:n+a}default:{let n=await r(e,t);return+("boolean"===n.type&&!0===n.data)}}}async function z(e,t,r,n){let a=await n(e,r),o=await n(t,r),i=[],s=[];if(await E(a,e=>{i=i.concat(C(e))}),!await E(o,e=>{s=s.concat(A(e))})||0===i.length||0===s.length)return 0;let u=0;for(let e of s){let t=i.reduce((t,r)=>t+ +!!e.test(r),0);u+=2.2*t/(t+1.2)}return u}let U={};U.anywhere=async function(){throw Error("not implemented")},U.anywhere.arity=1,U.coalesce=async function(e,t,r){for(let n of e){let e=await r(n,t);if("null"!==e.type)return e}return l},U.count=async function(e,t,r){let n=await r(e[0],t);if(!n.isArray())return l;let a=0;for await(let e of n)a++;return f(a)},U.count.arity=1,U.dateTime=async function(e,t,r){let n=await r(e[0],t);return"datetime"===n.type?n:"string"!==n.type?l:y.parseToValue(n.data)},U.dateTime.arity=1,U.defined=async function(e,t,r){return"null"===(await r(e[0],t)).type?p:c},U.defined.arity=1,U.identity=async function(e,t){return d(t.context.identity)},U.identity.arity=0,U.length=async function(e,t,r){let n=await r(e[0],t);if("string"===n.type)return f(function(e){let t=0;for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);n>=55296&&n<=56319||t++}return t}(n.data));if(n.isArray()){let e=0;for await(let t of n)e++;return f(e)}return l},U.length.arity=1,U.path=async function(e,t,r){let n=await r(e[0],t);return"string"!==n.type?l:new u(new a(n.data),"path")},U.path.arity=1,U.string=async function(e,t,r){let n=await r(e[0],t);switch(n.type){case"number":case"string":case"boolean":case"datetime":return d(`${n.data}`);default:return l}},U.string.arity=1,U.references=async function(e,t,r){let n=new Set;for(let a of e){let e=await r(a,t);if("string"===e.type)n.add(e.data);else if(e.isArray())for await(let t of e)"string"===t.type&&n.add(t.data)}return 0===n.size||!function e(t,r){switch(m(t)){case"array":for(let n of t)if(e(n,r))return!0;break;case"object":if(t._ref)return r.has(t._ref);for(let n of Object.values(t))if(e(n,r))return!0}return!1}(await t.value.get(),n)?p:c},U.references.arity=e=>e>=1,U.round=async function(e,t,r){let n=await r(e[0],t);if("number"!==n.type)return l;let a=n.data,o=0;if(2===e.length){let n=await r(e[1],t);if("number"!==n.type||n.data<0||!Number.isInteger(n.data))return l;o=n.data}return 0===o?a<0?f(-Math.round(-a)):f(Math.round(a)):f(Number(a.toFixed(o)))},U.round.arity=e=>e>=1&&e<=2,U.now=async function(e,t){return d(t.context.timestamp.toISOString())},U.now.arity=0,U.boost=async function(){throw Error("unexpected boost call")},U.boost.arity=2;let G={};G.lower=async function(e,t,r){let n=await r(e[0],t);return"string"!==n.type?l:d(n.data.toLowerCase())},G.lower.arity=1,G.upper=async function(e,t,r){let n=await r(e[0],t);return"string"!==n.type?l:d(n.data.toUpperCase())},G.upper.arity=1,G.split=async function(e,t,r){let n=await r(e[0],t);if("string"!==n.type)return l;let a=await r(e[1],t);return"string"!==a.type?l:0===n.data.length?b([]):0===a.data.length?b(Array.from(n.data)):b(n.data.split(a.data))},G.split.arity=2,U.lower=G.lower,U.upper=G.upper,G.startsWith=async function(e,t,r){let n=await r(e[0],t);if("string"!==n.type)return l;let a=await r(e[1],t);return"string"!==a.type?l:n.data.startsWith(a.data)?c:p},G.startsWith.arity=2;let q={};q.join=async function(e,t,r){let n=await r(e[0],t);if(!n.isArray())return l;let a=await r(e[1],t);if("string"!==a.type)return l;let o="",i=!1;for await(let e of n){switch(i&&(o+=a.data),e.type){case"number":case"string":case"boolean":case"datetime":o+=`${e.data}`;break;default:return l}i=!0}return b(o)},q.join.arity=2,q.compact=async function(e,t,r){let n=await r(e[0],t);return n.isArray()?new o(async function*(){for await(let e of n)"null"!==e.type&&(yield e)}):l},q.compact.arity=1,q.unique=async function(e,t,r){let n=await r(e[0],t);return n.isArray()?new o(async function*(){let e=new Set;for await(let t of n)switch(t.type){case"number":case"string":case"boolean":case"datetime":e.has(t.data)||(e.add(t.data),yield t);break;default:yield t}}):l},q.unique.arity=1,q.intersects=async function(e,t,r){let n=await r(e[0],t);if(!n.isArray())return l;let a=await r(e[1],t);if(!a.isArray())return l;for await(let e of n)for await(let t of a)if(v(e,t))return c;return p},q.intersects.arity=2;let H={};H.text=async function(e,t,r){let n=await r(e[0],t),a=await N(n);return null===a?l:d(a)},H.text.arity=1;let L={};L.projectId=async function(e,t){return t.context.sanity?d(t.context.sanity.projectId):l},L.dataset=async function(e,t){return t.context.sanity?d(t.context.sanity.dataset):l},L.versionOf=async function(e,t,r){let n=await r(e[0],t);if("string"!==n.type)return l;let a=n.data,o=await t.value.get();if(!o||"string"!=typeof o._id)return l;let i=o._id.split(".");return o._id===a||i.length>=2&&"drafts"===i[0]&&i.slice(1).join(".")===a||i.length>=3&&"versions"===i[0]&&i.slice(2).join(".")===a?c:p},L.versionOf.arity=1,L.partOfRelease=async function(e,t,r){let n=await r(e[0],t);if("string"!==n.type)return l;let a=n.data,o=await t.value.get();if(!o||"string"!=typeof o._id)return l;let i=o._id.split(".");return b(i.length>=3&&"versions"===i[0]&&i[1]===a)},L.partOfRelease.arity=1;let W={};W.all=async function(e,t){let r=[];for await(let e of t.source)if("object"===m(e)){let t=await e.get();t&&"_type"in t&&"system.release"===t._type&&r.push(t)}return b(r)},W.all.arity=0;let K={};K.order=async function(e,t,r,n){if(await !0,!e.isArray())return l;let a=[],o=[],i=0;for(let e of t){let t="asc";"Desc"===e.type?(t="desc",e=e.base):"Asc"===e.type&&(e=e.base),a.push(e),o.push(t),i++}let s=[],u=0;for await(let t of e){let e=r.createNested(t),o=[await t.get(),u];for(let t=0;t<i;t++){let r=await n(a[t],e);o.push(await r.get())}s.push(o),u++}return s.sort((e,t)=>{for(let r=0;r<i;r++){let n=function(e,t){let r=m(e),n=m(t),a=S[r]||100,o=S[n]||100;if(a!==o)return a-o;let i=F(e,t);return null===i&&(i=0),i}(e[r+2],t[r+2]);if("desc"===o[r]&&(n=-n),0!==n)return n}return e[1]-t[1]}),b(s.map(e=>e[0]))},K.order.arity=e=>e>=1,K.score=async function(e,t,r,n){if(!e.isArray())return l;let a=[],o=[];for await(let i of e){if("object"!==i.type){a.push(await i.get());continue}let e=r.createNested(i),s="number"==typeof i.data._score?i.data._score:0;for(let r of t)s+=await D(r,e,n);let u=Object.assign({},i.data,{_score:s});o.push(u)}return o.sort((e,t)=>t._score-e._score),b(o)},K.score.arity=e=>e>=1;let J={};J.operation=async function(e,t){let r=null!==t.context.before,n=null!==t.context.after;return r&&n?d("update"):n?d("create"):r?d("delete"):l},J.changedAny=()=>{throw Error("not implemented")},J.changedAny.arity=1,J.changedAny.mode="delta",J.changedOnly=()=>{throw Error("not implemented")},J.changedOnly.arity=1,J.changedOnly.mode="delta";let Q={};Q.changedAny=()=>{throw Error("not implemented")},Q.changedAny.arity=3,Q.changedOnly=()=>{throw Error("not implemented")},Q.changedOnly.arity=3;let Z={};Z.min=async function(e,t,r){let n,a=await r(e[0],t);if(!a.isArray())return l;for await(let e of a)if("null"!==e.type){if("number"!==e.type)return l;(void 0===n||e.data<n)&&(n=e.data)}return b(n)},Z.min.arity=1,Z.max=async function(e,t,r){let n,a=await r(e[0],t);if(!a.isArray())return l;for await(let e of a)if("null"!==e.type){if("number"!==e.type)return l;(void 0===n||e.data>n)&&(n=e.data)}return b(n)},Z.max.arity=1,Z.sum=async function(e,t,r){let n=await r(e[0],t);if(!n.isArray())return l;let a=0;for await(let e of n)if("null"!==e.type){if("number"!==e.type)return l;a+=e.data}return b(a)},Z.sum.arity=1,Z.avg=async function(e,t,r){let n=await r(e[0],t);if(!n.isArray())return l;let a=0,o=0;for await(let e of n)if("null"!==e.type){if("number"!==e.type)return l;a+=e.data,o++}return 0===o?l:b(a/o)},Z.avg.arity=1;let Y={};Y.now=async function(e,t){return h(new y(t.context.timestamp))},Y.now.arity=0;let X={};X.query=()=>{throw Error("not implemented")},X.query.arity=1;let ee={global:U,string:G,array:q,pt:H,delta:J,diff:Q,sanity:L,math:Z,dateTime:Y,releases:W,text:X};class et{string;marks;index;parseOptions;allowBoost=!1;constructor(e,t,r){this.string=e,this.marks=t,this.index=0,this.parseOptions=r}hasMark(e=0){return this.index+e<this.marks.length}getMark(e=0){return this.marks[this.index+e]}shift(){this.index+=1}process(e){let t=this.marks[this.index];this.shift();let r=e[t.name];if(!r)throw Error(`Unknown handler: ${t.name}`);return r.call(e,this,t)}processString(){return this.shift(),this.processStringEnd()}processStringEnd(){let e=this.marks[this.index-1],t=this.marks[this.index];return this.shift(),this.string.slice(e.position,t.position)}slice(e){let t=this.marks[this.index].position;return this.string.slice(t,t+e)}}let er=/^([\t\n\v\f\r \u0085\u00A0]|(\/\/[^\n]*\n))+/,en=/^\d+/,ea=/^[a-zA-Z_][a-zA-Z_0-9]*/;function eo(e,t,r){let n=t,a;switch(e[t]){case"+":{let r=eo(e,el(e,t+1),10);if("error"===r.type)return r;a=[{name:"pos",position:n}].concat(r.marks),t=r.position;break}case"-":{let r=eo(e,el(e,t+1),8);if("error"===r.type)return r;a=[{name:"neg",position:n}].concat(r.marks),t=r.position;break}case"(":{let r=eo(e,el(e,t+1),0);if("error"===r.type)return r;switch(t=el(e,r.position),e[t]){case",":for(a=[{name:"tuple",position:n}].concat(r.marks),t=el(e,t+1);;){if("error"===(r=eo(e,t,0)).type)return r;if(t=el(e,r.position),","!==e[t])break;t=el(e,t+1)}if(")"!==e[t])return{type:"error",position:t};t++,a.push({name:"tuple_end",position:t});break;case")":t++,a=[{name:"group",position:n}].concat(r.marks);break;default:return{type:"error",position:t}}break}case"!":{let r=eo(e,el(e,t+1),10);if("error"===r.type)return r;a=[{name:"not",position:n}].concat(r.marks),t=r.position;break}case"{":{let r=eu(e,t);if("error"===r.type)return r;a=r.marks,t=r.position;break}case"[":if(a=[{name:"array",position:t}],t=el(e,t+1),"]"!==e[t])for(;;){"..."===e.slice(t,t+3)&&(a.push({name:"array_splat",position:t}),t=el(e,t+3));let r=eo(e,t,0);if("error"===r.type)return r;if(a=a.concat(r.marks),t=el(e,t=r.position),","!==e[t]||(t=el(e,t+1),"]"===e[t]))break}if("]"!==e[t])return{type:"error",position:t};t++,a.push({name:"array_end",position:t});break;case"'":case'"':{let r=function(e,t){let r=e[t],n=[{name:"str",position:t+=1}];e:for(;;t++){if(t>e.length)return{type:"error",position:t};switch(e[t]){case r:n.push({name:"str_end",position:t}),t++;break e;case"\\":n.push({name:"str_pause",position:t}),"u"===e[t+1]?"{"===e[t+2]?(n.push({name:"unicode_hex",position:t+3}),t=e.indexOf("}",t+3),n.push({name:"unicode_hex_end",position:t})):(n.push({name:"unicode_hex",position:t+2}),n.push({name:"unicode_hex_end",position:t+6}),t+=5):(n.push({name:"single_escape",position:t+1}),t+=1),n.push({name:"str_start",position:t+1})}}return{type:"success",marks:n,position:t}}(e,t);if("error"===r.type)return r;a=r.marks,t=r.position;break}case"^":for(t++,a=[];"."===e[t]&&"^"===e[t+1];)a.push({name:"dblparent",position:n}),t+=2;a.push({name:"parent",position:n});break;case"@":a=[{name:"this",position:n}],t++;break;case"*":a=[{name:"everything",position:n}],t++;break;case"$":{let r=ec(e,t+1,ea);r&&(t+=1+r,a=[{name:"param",position:n},{name:"ident",position:n+1},{name:"ident_end",position:t}]);break}default:{let r=ec(e,t,en);if(r){let o="integer";if("."===e[t+=r]){let r=ec(e,t+1,en);r&&(o="float",t+=1+r)}if("e"===e[t]||"E"===e[t]){o="sci",("+"===e[++t]||"-"===e[t])&&t++;let r=ec(e,t,en);if(!r)return{type:"error",position:t};t+=r}a=[{name:o,position:n},{name:o+"_end",position:t}];break}let o=ec(e,t,ea);if(o)switch(e[t+=o]){case":":case"(":{let r=es(e,n,t);if("error"===r.type)return r;a=r.marks,t=r.position;break}default:a=[{name:"this_attr",position:n},{name:"ident",position:n},{name:"ident_end",position:t}]}}}if(!a)return{type:"error",position:t};let o=12,i;t:for(;;){let s=el(e,t);if(s===e.length){t=s;break}if("success"===(i=ei(e,s)).type){for(a.unshift({name:"traverse",position:n});"success"===i.type;)a=a.concat(i.marks),i=ei(e,el(e,t=i.position));a.push({name:"traversal_end",position:t});continue}switch(e[s]){case"=":switch(e[s+1]){case">":{if(r>1||o<=1)break t;let i=eo(e,el(e,s+2),1);if("error"===i.type)return i;(a=a.concat(i.marks)).unshift({name:"pair",position:n}),t=i.position,o=1;break}case"=":{if(r>4||o<=4)break t;let i=eo(e,el(e,s+2),5);if("error"===i.type)return i;a.unshift({name:"comp",position:n}),a.push({name:"op",position:s},{name:"op_end",position:s+2}),a=a.concat(i.marks),t=i.position,o=4;break}default:break t}break;case"+":{if(r>6||o<6)break t;let i=eo(e,el(e,s+1),7);if("error"===i.type)return i;(a=a.concat(i.marks)).unshift({name:"add",position:n}),t=i.position,o=6;break}case"-":{if(r>6||o<6)break t;let i=eo(e,el(e,s+1),7);if("error"===i.type)return i;(a=a.concat(i.marks)).unshift({name:"sub",position:n}),t=i.position,o=6;break}case"*":{if("*"===e[s+1]){if(r>8||o<=8)break t;let i=eo(e,el(e,s+2),8);if("error"===i.type)return i;(a=a.concat(i.marks)).unshift({name:"pow",position:n}),t=i.position,o=8;break}if(r>7||o<7)break t;let i=eo(e,el(e,s+1),8);if("error"===i.type)return i;(a=a.concat(i.marks)).unshift({name:"mul",position:n}),t=i.position,o=7;break}case"/":{if(r>7||o<7)break t;let i=eo(e,el(e,s+1),8);if("error"===i.type)return i;(a=a.concat(i.marks)).unshift({name:"div",position:n}),t=i.position,o=7;break}case"%":{if(r>7||o<7)break t;let i=eo(e,el(e,s+1),8);if("error"===i.type)return i;(a=a.concat(i.marks)).unshift({name:"mod",position:n}),t=i.position,o=7;break}case"<":case">":{if(r>4||o<=4)break t;let i=s+1;"="===e[i]&&i++;let u=eo(e,el(e,i),5);if("error"===u.type)return u;a.unshift({name:"comp",position:n}),a.push({name:"op",position:s},{name:"op_end",position:i}),a=a.concat(u.marks),t=u.position,o=4;break}case"|":if("|"===e[s+1]){if(r>2||o<2)break t;let i=eo(e,el(e,s+2),3);if("error"===i.type)return i;(a=a.concat(i.marks)).unshift({name:"or",position:n}),t=i.position,o=2}else{if(r>11||o<11)break t;let i=el(e,s+1),u=ec(e,i,ea);if(!u)return{type:"error",position:i};if("("===e[t=i+u]||":"===e[t]){let r=es(e,i,t);if("error"===r.type)return r;(a=a.concat(r.marks)).unshift({name:"pipecall",position:n}),t=r.position,o=11}}break;case"&":{if("&"!=e[s+1]||r>3||o<3)break t;let i=eo(e,el(e,s+2),4);if("error"===i.type)return i;(a=a.concat(i.marks)).unshift({name:"and",position:n}),t=i.position,o=3;break}case"!":{if("="!==e[s+1]||r>4||o<=4)break t;let i=eo(e,el(e,s+2),5);if("error"===i.type)return i;a.unshift({name:"comp",position:n}),a.push({name:"op",position:s},{name:"op_end",position:s+2}),a=a.concat(i.marks),t=i.position,o=4;break}case"d":if("desc"!==e.slice(s,s+4)||r>4||o<4)break t;a.unshift({name:"desc",position:n}),t=s+4,o=4;break;case"a":if("asc"!==e.slice(s,s+3)||r>4||o<4)break t;a.unshift({name:"asc",position:n}),t=s+3,o=4;break;default:switch(function(e,t,r){let n=r.exec(e.slice(t));return n?n[0]:null}(e,s,ea)){case"in":{if(r>4||o<=4)break t;t=el(e,s+2);let i=!1;"("===e[t]&&(i=!0,t=el(e,t+1));let u=t,l=eo(e,t,5);if("error"===l.type)return l;if(t=el(e,l.position),"."===e[t]&&"."===e[t+1]){let r="inc_range";"."===e[t+2]?(r="exc_range",t=el(e,t+3)):t=el(e,t+2);let o=eo(e,t,5);if("error"===o.type)return o;a.unshift({name:"in_range",position:n}),a=a.concat({name:r,position:u},l.marks,o.marks),t=o.position}else a.unshift({name:"comp",position:n}),a.push({name:"op",position:s},{name:"op_end",position:s+2}),a=a.concat(l.marks);if(i){if(t=el(e,t),")"!==e[t])return{type:"error",position:t};t++}o=4;break}case"match":{if(r>4||o<=4)break t;let i=eo(e,el(e,s+5),5);if("error"===i.type)return i;a.unshift({name:"comp",position:n}),a.push({name:"op",position:s},{name:"op_end",position:s+5}),a=a.concat(i.marks),t=i.position,o=4;break}default:break t}}}return{type:"success",marks:a,position:t,failPosition:i?.type==="error"&&i.position}}function ei(e,t){let r=t;switch(e[t]){case".":{let n=t=el(e,t+1),a=ec(e,t,ea);return a?{type:"success",marks:[{name:"attr_access",position:r},{name:"ident",position:n},{name:"ident_end",position:t+=a}],position:t}:{type:"error",position:t}}case"-":if(">"!==e[t+1])break;let n=[{name:"deref",position:r}],a=el(e,t+=2),o=ec(e,a,ea);return o&&(t=a+o,n.push({name:"deref_attr",position:a},{name:"ident",position:a},{name:"ident_end",position:t})),{type:"success",marks:n,position:t};case"[":{if(t=el(e,t+1),"]"===e[t])return{type:"success",marks:[{name:"array_postfix",position:r}],position:t+1};let n=t,a=eo(e,t,0);if("error"===a.type)return a;if(t=el(e,a.position),"."===e[t]&&"."===e[t+1]){let o="inc_range";"."===e[t+2]?(o="exc_range",t+=3):t+=2,t=el(e,t);let i=eo(e,t,0);return"error"===i.type?i:(t=el(e,i.position),"]"!==e[t]?{type:"error",position:t}:{type:"success",marks:[{name:"slice",position:r},{name:o,position:n}].concat(a.marks,i.marks),position:t+1})}return"]"!==e[t]?{type:"error",position:t}:{type:"success",marks:[{name:"square_bracket",position:r}].concat(a.marks),position:t+1}}case"|":if(t=el(e,t+1),"{"===e[t]){let n=eu(e,t);return"error"===n.type||n.marks.unshift({name:"projection",position:r}),n}break;case"{":{let n=eu(e,t);return"error"===n.type||n.marks.unshift({name:"projection",position:r}),n}}return{type:"error",position:t}}function es(e,t,r){let n=[];if(n.push({name:"func_call",position:t}),":"===e[r]&&":"===e[r+1]){n.push({name:"namespace",position:t}),n.push({name:"ident",position:t},{name:"ident_end",position:r}),r=el(e,r+2);let a=ec(e,r,ea);if(!a||(n.push({name:"ident",position:r},{name:"ident_end",position:r+a}),r=el(e,r+a),"("!==e[r]))return{type:"error",position:r};r=el(e,++r)}else n.push({name:"ident",position:t},{name:"ident_end",position:r}),r=el(e,r+1);let a=r;if(")"!==e[r])for(;;){let t=eo(e,r,0);if("error"===t.type)return t;if(n=n.concat(t.marks),a=t.position,r=el(e,t.position),","!==e[r]||(r=el(e,r+1),")"===e[r]))break}return")"!==e[r]?{type:"error",position:r}:(n.push({name:"func_args_end",position:a}),{type:"success",marks:n,position:r+1})}function eu(e,t){let r=[{name:"object",position:t}];for(t=el(e,t+1);"}"!==e[t];){let n=t;if("..."===e.slice(t,t+3))if(t=el(e,t+3),"}"!==e[t]&&","!==e[t]){let a=eo(e,t,0);if("error"===a.type)return a;r.push({name:"object_splat",position:n}),r=r.concat(a.marks),t=a.position}else r.push({name:"object_splat_this",position:n});else{let a=eo(e,t,0);if("error"===a.type)return a;let o=el(e,a.position);if("str"===a.marks[0].name&&":"===e[o]){let i=eo(e,el(e,o+1),0);if("error"===i.type)return i;r.push({name:"object_pair",position:n}),r=r.concat(a.marks,i.marks),t=i.position}else r=r.concat({name:"object_expr",position:t},a.marks),t=a.position}if(t=el(e,t),","!==e[t])break;t=el(e,t+1)}return"}"!==e[t]?{type:"error",position:t}:(t++,r.push({name:"object_end",position:t}),{type:"success",marks:r,position:t})}function el(e,t){return t+ec(e,t,er)}function ec(e,t,r){let n=r.exec(e.slice(t));return n?n[0].length:0}function ep(e,t){return r=>t(e(r))}function ey(e){return t=>({type:"Map",base:t,expr:e({type:"This"})})}function ef(e,t){if(!t)return{type:"a-a",build:e};switch(t.type){case"a-a":return{type:"a-a",build:ep(e,t.build)};case"a-b":return{type:"a-b",build:ep(e,t.build)};case"b-b":return{type:"a-a",build:ep(e,ey(t.build))};case"b-a":var r;return{type:"a-a",build:ep(e,(r=t.build,e=>({type:"FlatMap",base:e,expr:r({type:"This"})})))};default:throw Error(`unknown type: ${t.type}`)}}function ed(e,t){if(!t)return{type:"b-b",build:e};switch(t.type){case"a-a":case"b-a":return{type:"b-a",build:ep(e,t.build)};case"a-b":case"b-b":return{type:"b-b",build:ep(e,t.build)};default:throw Error(`unknown type: ${t.type}`)}}let eh={"'":"'",'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"};class eb extends Error{name="GroqQueryError"}let em={group:e=>({type:"Group",base:e.process(em)}),everything:()=>({type:"Everything"}),this:()=>({type:"This"}),parent:()=>({type:"Parent",n:1}),dblparent:e=>({type:"Parent",n:e.process(em).n+1}),traverse(e){let t=e.process(em),r=[];for(;"traversal_end"!==e.getMark().name;)r.push(e.process(eg));e.shift();let n=null;for(let e=r.length-1;e>=0;e--)n=r[e](n);if(("Everything"===t.type||"Array"===t.type||"PipeFuncCall"===t.type)&&(n=ef(e=>e,n)),null===n)throw Error("BUG: unexpected empty traversal");return n.build(t)},this_attr(e){let t=e.processString();return"null"===t?{type:"Value",value:null}:"true"===t?{type:"Value",value:!0}:"false"===t?{type:"Value",value:!1}:{type:"AccessAttribute",name:t}},neg:e=>({type:"Neg",base:e.process(em)}),pos:e=>({type:"Pos",base:e.process(em)}),add:e=>({type:"OpCall",op:"+",left:e.process(em),right:e.process(em)}),sub:e=>({type:"OpCall",op:"-",left:e.process(em),right:e.process(em)}),mul:e=>({type:"OpCall",op:"*",left:e.process(em),right:e.process(em)}),div:e=>({type:"OpCall",op:"/",left:e.process(em),right:e.process(em)}),mod:e=>({type:"OpCall",op:"%",left:e.process(em),right:e.process(em)}),pow:e=>({type:"OpCall",op:"**",left:e.process(em),right:e.process(em)}),comp(e){let t=e.process(em);return{type:"OpCall",op:e.processString(),left:t,right:e.process(em)}},in_range(e){let t=e.process(em),r="inc_range"===e.getMark().name;return e.shift(),{type:"InRange",base:t,left:e.process(em),right:e.process(em),isInclusive:r}},str(e){let t="";t:for(;e.hasMark();){let r=e.getMark();switch(r.name){case"str_end":t+=e.processStringEnd();break t;case"str_pause":t+=e.processStringEnd();break;case"str_start":e.shift();break;case"single_escape":{let r=e.slice(1);e.shift(),t+=eh[r];break}case"unicode_hex":e.shift(),t+=String.fromCharCode(parseInt(e.processStringEnd(),16));break;default:throw Error(`unexpected mark: ${r.name}`)}}return{type:"Value",value:t}},integer:e=>({type:"Value",value:Number(e.processStringEnd())}),float:e=>({type:"Value",value:Number(e.processStringEnd())}),sci:e=>({type:"Value",value:Number(e.processStringEnd())}),object(e){let t=[];for(;"object_end"!==e.getMark().name;)t.push(e.process(ev));return e.shift(),{type:"Object",attributes:t}},array(e){let t=[];for(;"array_end"!==e.getMark().name;){let r=!1;"array_splat"===e.getMark().name&&(r=!0,e.shift());let n=e.process(em);t.push({type:"ArrayElement",value:n,isSplat:r})}return e.shift(),{type:"Array",elements:t}},tuple(e){let t=[];for(;"tuple_end"!==e.getMark().name;)t.push(e.process(em));return e.shift(),{type:"Tuple",members:t}},func_call(e){let t="global";"namespace"===e.getMark().name&&(e.shift(),t=e.processString());let r=e.processString();if("global"===t&&"select"===r){let t={type:"Select",alternatives:[]};for(;"func_args_end"!==e.getMark().name;)if("pair"===e.getMark().name){if(t.fallback)throw new eb("unexpected argument to select()");e.shift();let r=e.process(em),n=e.process(em);t.alternatives.push({type:"SelectAlternative",condition:r,value:n})}else{if(t.fallback)throw new eb("unexpected argument to select()");t.fallback=e.process(em)}return e.shift(),t}let n=[];for(;"func_args_end"!==e.getMark().name;){var a,o,i;(a=t,o=r,i=n.length,"diff"==a&&2==i&&["changedAny","changedOnly"].includes(o))?(e.process(ew),n.push({type:"Selector"})):n.push(e.process(em))}if(e.shift(),"global"===t&&("before"===r||"after"===r)&&"delta"===e.parseOptions.mode)return{type:"Context",key:r};if("global"===t&&"boost"===r&&!e.allowBoost)throw new eb("unexpected boost");let s=ee[t];if(!s)throw new eb(`Undefined namespace: ${t}`);let u=s[r];if(!u||(void 0!==u.arity&&ek(r,u.arity,n.length),void 0!==u.mode&&u.mode!==e.parseOptions.mode))throw new eb(`Undefined function: ${r}`);return{type:"FuncCall",func:u,namespace:t,name:r,args:n}},pipecall(e){let t=e.process(em);e.shift();let r="global";if("namespace"===e.getMark().name&&(e.shift(),r=e.processString()),"global"!==r)throw new eb(`Undefined namespace: ${r}`);let n=e.processString(),a=[],o=e.allowBoost;for("score"===n&&(e.allowBoost=!0);;){let t=e.getMark().name;if("func_args_end"===t)break;if("order"===n){if("asc"===t){e.shift(),a.push({type:"Asc",base:e.process(em)});continue}else if("desc"===t){e.shift(),a.push({type:"Desc",base:e.process(em)});continue}}a.push(e.process(em))}e.shift(),e.allowBoost=o;let i=K[n];if(!i)throw new eb(`Undefined pipe function: ${n}`);return i.arity&&ek(n,i.arity,a.length),{type:"PipeFuncCall",func:i,base:t,name:n,args:a}},pair(){throw new eb("unexpected =>")},and:e=>({type:"And",left:e.process(em),right:e.process(em)}),or:e=>({type:"Or",left:e.process(em),right:e.process(em)}),not:e=>({type:"Not",base:e.process(em)}),asc(){throw new eb("unexpected asc")},desc(){throw new eb("unexpected desc")},param(e){let t=e.processString();return e.parseOptions.params&&e.parseOptions.params.hasOwnProperty(t)?{type:"Value",value:e.parseOptions.params[t]}:{type:"Parameter",name:t}}},ev={object_expr(e){if("pair"===e.getMark().name)return e.shift(),{type:"ObjectConditionalSplat",condition:e.process(em),value:e.process(em)};let t=e.process(em);return{type:"ObjectAttributeValue",name:function e(t){if("AccessAttribute"===t.type&&!t.base)return t.name;if("PipeFuncCall"===t.type||"Deref"===t.type||"Map"===t.type||"Projection"===t.type||"Slice"===t.type||"Filter"===t.type||"AccessElement"===t.type||"ArrayCoerce"===t.type||"Group"===t.type)return e(t.base);throw new eb(`Cannot determine property key for type: ${t.type}`)}(t),value:t}},object_pair(e){let t=e.process(em);if("Value"!==t.type)throw Error("name must be string");let r=e.process(em);return{type:"ObjectAttributeValue",name:t.value,value:r}},object_splat:e=>({type:"ObjectSplat",value:e.process(em)}),object_splat_this:()=>({type:"ObjectSplat",value:{type:"This"}})},eg={square_bracket(e){let t=e.process(em),r=$(t);return r&&"number"===r.type?e=>(function(e,t){if(!t)return{type:"a-b",build:e};switch(t.type){case"a-a":case"b-a":return{type:"a-a",build:ep(e,t.build)};case"a-b":case"b-b":return{type:"a-b",build:ep(e,t.build)};default:throw Error(`unknown type: ${t.type}`)}})(e=>({type:"AccessElement",base:e,index:r.data}),e):r&&"string"===r.type?e=>ed(e=>({type:"AccessAttribute",base:e,name:r.data}),e):e=>ef(e=>({type:"Filter",base:e,expr:t}),e)},slice(e){let t="inc_range"===e.getMark().name;e.shift();let r=e.process(em),n=e.process(em),a=$(r),o=$(n);if(!a||!o||"number"!==a.type||"number"!==o.type)throw new eb("slicing must use constant numbers");return e=>ef(e=>({type:"Slice",base:e,left:a.data,right:o.data,isInclusive:t}),e)},projection(e){let t=e.process(em);return e=>(function(e,t){if(!t)return{type:"b-b",build:e};switch(t.type){case"a-a":return{type:"a-a",build:ep(ey(e),t.build)};case"a-b":return{type:"a-b",build:ep(ey(e),t.build)};case"b-a":return{type:"b-a",build:ep(e,t.build)};case"b-b":return{type:"b-b",build:ep(e,t.build)};default:throw Error(`unknown type: ${t.type}`)}})(e=>({type:"Projection",base:e,expr:t}),e)},attr_access(e){let t=e.processString();return e=>ed(e=>({type:"AccessAttribute",base:e,name:t}),e)},deref(e){let t=null;"deref_attr"===e.getMark().name&&(e.shift(),t=e.processString());let r=e=>t?{type:"AccessAttribute",base:e,name:t}:e;return e=>ed(e=>r({type:"Deref",base:e}),e)},array_postfix:()=>e=>ef(e=>({type:"ArrayCoerce",base:e}),e)},ew={group:e=>(e.process(ew),null),everything(){throw Error("Invalid selector syntax")},this(){throw Error("Invalid selector syntax")},parent(){throw Error("Invalid selector syntax")},dblparent(){throw Error("Invalid selector syntax")},traverse(e){for(e.process(ew);"traversal_end"!==e.getMark().name;)e.process(eg);return e.shift(),null},this_attr:e=>(e.processString(),null),neg(){throw Error("Invalid selector syntax")},pos(){throw Error("Invalid selector syntax")},add(){throw Error("Invalid selector syntax")},sub(){throw Error("Invalid selector syntax")},mul(){throw Error("Invalid selector syntax")},div(){throw Error("Invalid selector syntax")},mod(){throw Error("Invalid selector syntax")},pow(){throw Error("Invalid selector syntax")},comp(){throw Error("Invalid selector syntax")},in_range(){throw Error("Invalid selector syntax")},str(){throw Error("Invalid selector syntax")},integer(){throw Error("Invalid selector syntax")},float(){throw Error("Invalid selector syntax")},sci(){throw Error("Invalid selector syntax")},object(){throw Error("Invalid selector syntax")},array(){throw Error("Invalid selector syntax")},tuple(){throw Error("Invalid selector syntax")},func_call(e,t){let r=em.func_call(e,t);if("anywhere"===r.name&&1===r.args.length)return null;throw Error("Invalid selector syntax")},pipecall(){throw Error("Invalid selector syntax")},pair(){throw Error("Invalid selector syntax")},and(){throw Error("Invalid selector syntax")},or(){throw Error("Invalid selector syntax")},not(){throw Error("Invalid selector syntax")},asc(){throw Error("Invalid selector syntax")},desc(){throw Error("Invalid selector syntax")},param(){throw Error("Invalid selector syntax")}};function ek(e,t,r){if("number"==typeof t){if(r!==t)throw new eb(`Incorrect number of arguments to function ${e}(). Expected ${t}, got ${r}.`)}else if(t&&!t(r))throw new eb(`Incorrect number of arguments to function ${e}().`)}class ej extends Error{position;name="GroqSyntaxError";constructor(e){super(`Syntax error in GROQ query at position ${e}`),this.position=e}}let{compare:eC}=new Intl.Collator("en");function eO(e,t){return"null"===e.type?1:eC(eE(e),eE(t))}let eA=new WeakMap;function eE(e){if(eA.has(e))return eA.get(e);let t=function(e){switch(e.type){case"string":case"number":case"boolean":return void 0!==e.value?`${e.type}(${e.value})`:`${e.type}`;case"null":case"unknown":default:return e.type;case"array":return`${e.type}(${eE(e.of)})`;case"object":{let t=Object.entries(e.attributes);return t.sort(([e],[t])=>eC(e,t)),`${e.type}:(${t.map(([e,t])=>`${e}:${eE(t.value)}(${t.optional?"optional":"non-optional"})`).join(",")}):ref-${e.dereferencesTo}:${e.rest?eE(e.rest):"no-rest"}`}case"union":{let t=[...e.of];return t.sort(eO),`${e.type}(${t.map(eE).join(",")})`}case"inline":return`${e.type}(${e.name})`}}(e);return eA.set(e,t),t}function eS(e){if("union"===e.type){if(0===e.of.length)return e;if(e.of=function(e){let t=new Set,r=[],n=[...e];for(let e of(n.sort(eO),n)){let n=eE(e);if(null===n){r.push(e);continue}t.has(n)||(t.add(n),r.push(e))}return r}(e.of),1===e.of.length)return eS(e.of[0]);for(let t=0;e.of.length>t;t++){let r=e.of[t];if("union"===r.type){e.of.splice(t,1,...r.of),t--;continue}e.of[t]=eS(r)}return e.of.sort((e,t)=>"null"===e.type?1:eC(eE(e),eE(t))),e}if("array"===e.type)return e.of=eS(e.of),e;if("object"===e.type)for(let t in e.attributes)Object.hasOwn(e.attributes,t)&&(e.attributes[t].value=eS(e.attributes[t].value));return e}function eF(e){return"union"===e.type?ex(...e.of,{type:"null"}):ex(e,{type:"null"})}function ex(...e){return{type:"union",of:e}}function e_(e,t){return"inline"===e.type?e_(t.context.lookupTypeDeclaration(e),t):e}function eP(e,t,r,n=e=>eS({type:"union",of:e})){switch(e.type){case"boolean":case"array":case"null":case"object":case"string":case"number":case"unknown":return r(e);case"union":return n(e.of.map(e=>eP(e,t,r),n));case"inline":return eP(e_(e,t),t,r,n);default:throw Error(`Unknown type: ${e.type}`)}}function eB(e,t){switch(e.type){case"unknown":return{canBeTrue:!0,canBeFalse:!0,canBeNull:!0};case"boolean":return!0===e.value?{canBeTrue:!0,canBeFalse:!1,canBeNull:!1}:!1===e.value?{canBeTrue:!1,canBeFalse:!0,canBeNull:!1}:{canBeTrue:!0,canBeFalse:!0,canBeNull:!1};case"union":{let r={canBeTrue:!1,canBeFalse:!1,canBeNull:!1};for(let n of e.of){let e=eB(n,t);e.canBeNull&&(r.canBeNull=!0),e.canBeTrue&&(r.canBeTrue=!0),e.canBeFalse&&(r.canBeFalse=!0)}return r}case"inline":return eB(e_(e,t),t);case"null":case"string":case"number":case"object":case"array":return{canBeTrue:!1,canBeFalse:!1,canBeNull:!0};default:throw Error(`unknown node type ${e.type}`)}}function eM(e){return e.canBeTrue?e.canBeFalse?e.canBeNull?eF({type:"boolean"}):{type:"boolean"}:e.canBeNull?eF({type:"boolean",value:!0}):{type:"boolean",value:!0}:e.canBeFalse?e.canBeNull?eF({type:"boolean",value:!1}):{type:"boolean",value:!1}:{type:"null"}}n.default("typeEvaluator:scope:trace").log=console.log.bind(console);class eT{schema;constructor(e){this.schema=e}lookupRef(e){for(let t of this.schema)if("document"===t.type&&t.name===e)return{type:"object",attributes:t.attributes};return{type:"null"}}lookupTypeDeclaration(e){for(let t of this.schema)if("type"===t.type&&t.name===e.name)return t.value;return{type:"null"}}}class eI{value;parent;context;isHidden;constructor(e,t,r){this.value={type:"union",of:e},this.parent=t,this.context=r||t?.context||new eT([]),this.isHidden=!1}createNested(e){return this.isHidden?new eI(e,this.parent,this.context):new eI(e,this,this.context)}createHidden(e){let t=this.createNested(e);return t.isHidden=!0,t}}function e$(e){return"union"===e.type?{type:"union",of:e.of.filter(e=>"null"!==e.type)}:e}let eN=n.default("typeEvaluator:evaluate:trace");eN.log=console.log.bind(console);let eR=n.default("typeEvaluator:evaluate:debug");eR.log=console.log.bind(console);let eV=n.default("typeEvaluator:evaluate:warn");function eD(e,t){let r=eU({node:e.value,scope:t});return eN("object.splat.value %O",r),eP(r,t,e=>{if("unknown"===e.type)return{type:"unknown"};if("object"!==e.type)return{type:"object",attributes:{}};let r={};for(let t in e.attributes)e.attributes.hasOwnProperty(t)&&(r[t]=e.attributes[t]);if(void 0!==e.rest){let n=e_(e.rest,t);if("unknown"===n.type)return{type:"unknown"};if("object"!==n.type)return{type:"null"};for(let e in n.attributes)n.attributes.hasOwnProperty(e)&&(r[e]=n.attributes[e])}return{type:"object",attributes:r}})}let ez=Symbol("groq-js.type");function eU({node:e,scope:t}){if(ez in e)return e[ez];switch(e.type){case"Map":let r=eU({node:e.base,scope:t});return eN("map.base %O",r),eL(r,t,r=>({type:"array",of:eU({node:e.expr,scope:t.createHidden([r.of])})}));case"Projection":let n=eU({node:e.base,scope:t});return eN("projection.base %O",n),eW(n,t,r=>eU({node:e.expr,scope:t.createNested([r])}));case"Filter":let a=eU({node:e.base,scope:t});return eN("filter.base %O",a),eP(a,t,r=>{if(eN("filter.resolving %O",r),"null"===r.type)return r;let n=eH(e.expr,"array"===r.type?"union"===r.of.type?t.createNested(r.of.of):t.createNested([r.of]):t.createNested([r]));return eN("filter.resolved %O",n),{type:"array",of:n}});case"AccessAttribute":let o;return eS((o=t.value,e.base&&(o=eU({node:e.base,scope:t})),eN("accessAttribute.base %s %O",e.name,o),function e(t,r,n){return eW(t,n,t=>{eN('Looking for attribute "%s" in object %O',r,t);let a=t.attributes[r];return void 0!==a?(eR(`accessAttribute.attribute found ${r} %O`,a),a.optional?eF(a.value):a.value):t.rest?e(t.rest,r,n):(eV(`attribute "${r}" not found in object`),{type:"null"})})}(o,e.name,t)));case"AccessElement":let i=eU({node:e.base,scope:t});return eN("accessElement.base %O",i),eL(i,t,e=>eF(e.of));case"ArrayCoerce":let s=eU({node:e.base,scope:t});return eN("arrayCoerce.base %O",s),eL(s,t,e=>e);case"FlatMap":return eL(eU({node:e.base,scope:t}),t,r=>eP(eU({node:e.expr,scope:t.createHidden([r.of])}),t,e=>"array"===e.type?e:{type:"array",of:e},e=>{let t=[];for(let r of e){if("unknown"===r.type)return{type:"array",of:r};if("array"!==r.type)throw Error(`Unexpected type: ${r.type}`);t.push(r.of)}return{type:"array",of:eS({type:"union",of:t})}}));case"OpCall":eN("opcall.node %O",e);let u=eU({node:e.left,scope:t}),l=eU({node:e.right,scope:t});return eP(u,t,r=>eP(l,t,n=>{switch(eN('opcall.node.concrete "%s" %O',e.op,{left:r,right:n}),e.op){case"==":return"unknown"===r.type||"unknown"===n.type?{type:"boolean"}:r.type!==n.type?{type:"boolean",value:!1}:"null"===r.type?{type:"boolean",value:!0}:eG(r)&&eG(n)?{type:"boolean",value:eq(e.op,r,n)}:{type:"boolean",value:!1};case"!=":{if("unknown"===r.type||"unknown"===n.type)return{type:"boolean"};if(r.type!==n.type)return{type:"boolean",value:!0};if("null"===r.type)return{type:"boolean",value:!1};if(!eG(r)||!eG(n))return{type:"boolean",value:!0};let e=eq("==",r,n);return void 0!==e&&(e=!e),{type:"boolean",value:e}}case">":case">=":case"<":case"<=":return"unknown"===r.type||"unknown"===n.type?eF({type:"boolean"}):r.type!==n.type?{type:"null"}:eG(r)&&eG(n)?{type:"boolean",value:eq(e.op,r,n)}:{type:"null"};case"in":return"unknown"===r.type||"unknown"===n.type?eF({type:"boolean"}):"array"!==n.type?!function e(t,r){return"Group"===t.type?e(t.base,r):"FuncCall"===t.type&&`${t.namespace}::${t.name}`===r}(e.right,"global::path")?{type:"null"}:{type:"boolean"}:eG(r)||"null"===r.type?eP(n.of,t,e=>"unknown"===e.type?eF({type:"boolean"}):"null"===r.type?{type:"boolean",value:"null"===e.type}:void 0===r.value?{type:"boolean"}:eG(e)?void 0===e.value?{type:"boolean"}:{type:"boolean",value:r.value===e.value}:{type:"boolean",value:!1}):{type:"boolean",value:!1};case"match":return"unknown"===r.type||"unknown"===n.type?{type:"boolean"}:{type:"boolean",value:function(e,t){let r=[],n=[];if("string"===e.type){if(void 0===e.value)return;r=r.concat(C(e.value))}if("array"===e.type){if("unknown"===e.of.type)return;if("string"===e.of.type){if(void 0===e.of.value)return;r=r.concat(C(e.of.value))}if("union"===e.of.type)for(let t of e.of.of)"string"===t.type&&void 0!==t.value&&(r=r.concat(C(t.value)))}if("string"===t.type){if(void 0===t.value)return;n=n.concat(O(t.value))}if("array"===t.type){if("unknown"===t.of.type)return;if("string"===t.of.type){if(void 0===t.of.value)return;n=n.concat(O(t.of.value))}if("union"===t.of.type)for(let e of t.of.of){if("string"===e.type){if(void 0===e.value)return;n=n.concat(O(e.value))}if("string"!==e.type)return!1}}return j(r,n)}(r,n)};case"+":return"unknown"===r.type||"unknown"===n.type?{type:"unknown"}:"string"===r.type&&"string"===n.type?{type:"string",value:void 0!==r.value&&void 0!==n.value?r.value+n.value:void 0}:"number"===r.type&&"number"===n.type?{type:"number",value:void 0!==r.value&&void 0!==n.value?r.value+n.value:void 0}:"array"===r.type&&"array"===n.type?{type:"array",of:{type:"union",of:[r.of,n.of]}}:"object"===r.type&&"object"===n.type?{type:"object",attributes:{...r.attributes,...n.attributes}}:{type:"null"};case"-":return"unknown"===r.type||"unknown"===n.type?eF({type:"number"}):"number"===r.type&&"number"===n.type?{type:"number",value:void 0!==r.value&&void 0!==n.value?r.value-n.value:void 0}:{type:"null"};case"*":return"unknown"===r.type||"unknown"===n.type?eF({type:"number"}):"number"===r.type&&"number"===n.type?{type:"number",value:void 0!==r.value&&void 0!==n.value?r.value*n.value:void 0}:{type:"null"};case"/":return"unknown"===r.type||"unknown"===n.type?eF({type:"number"}):"number"===r.type&&"number"===n.type?{type:"number",value:void 0!==r.value&&void 0!==n.value?r.value/n.value:void 0}:{type:"null"};case"**":return"unknown"===r.type||"unknown"===n.type?eF({type:"number"}):"number"===r.type&&"number"===n.type?{type:"number",value:void 0!==r.value&&void 0!==n.value?r.value**n.value:void 0}:{type:"null"};case"%":return"unknown"===r.type||"unknown"===n.type?eF({type:"number"}):"number"===r.type&&"number"===n.type?{type:"number",value:void 0!==r.value&&void 0!==n.value?r.value%n.value:void 0}:{type:"null"};default:return{type:"unknown"}}}));case"And":let c=eU({node:e.left,scope:t}),p=eU({node:e.right,scope:t});return eP(c,t,e=>eP(p,t,r=>{var n,a;return eM((n=eB(e,t),a=eB(r,t),!n.canBeFalse||n.canBeTrue||n.canBeNull?!a.canBeFalse||a.canBeTrue||a.canBeNull?{canBeTrue:n.canBeTrue&&a.canBeTrue,canBeFalse:n.canBeFalse||a.canBeFalse,canBeNull:n.canBeNull||a.canBeNull}:a:n))}));case"Or":let y=eU({node:e.left,scope:t}),f=eU({node:e.right,scope:t});return eP(y,t,e=>eP(f,t,r=>{var n,a;return eM((n=eB(e,t),a=eB(r,t),!n.canBeTrue||n.canBeFalse||n.canBeNull?!a.canBeTrue||a.canBeFalse||a.canBeNull?{canBeTrue:n.canBeTrue||a.canBeTrue,canBeFalse:n.canBeFalse&&a.canBeFalse,canBeNull:n.canBeNull||a.canBeNull}:a:n))}));case"Select":let d=[],h=!1;for(let r of e.alternatives){let e=eU({node:r.condition,scope:t}),n=eH(r.condition,t);"union"===n.type&&n.of.length>0&&d.push(eU({node:r.value,scope:t.createHidden(n.of)})),"boolean"===e.type&&!0===e.value&&(h=!0)}return e.fallback&&!h&&d.push(eU({node:e.fallback,scope:t})),0===d.length?{type:"null"}:{type:"union",of:d};case"PipeFuncCall":case"Group":return eU({node:e.base,scope:t});case"Deref":eN("deref.node %O",e);let b=eU({node:e.base,scope:t});if(eN("deref.base %O",b),"null"===b.type||"unknown"===b.type)return{type:"null"};let m=function e(t,r){return"union"===t.type?{type:"union",of:t.of.map(t=>e(t,r))}:"array"===t.type?{type:"array",of:e(t.of,r)}:"object"===t.type&&void 0!==t.dereferencesTo?r.context.lookupRef(t.dereferencesTo):{type:"null"}}(b,t);return eN("deref.derefedNode %O",m),m;case"Object":return function(e,t){if(eN("object.node %O",e),0===e.attributes.length)return{type:"object",attributes:{}};let r=[],n=[],a=[];for(let[o,i]of e.attributes.entries()){if("ObjectAttributeValue"===i.type){let e=eU({node:i.value,scope:t});r.push([o,i.name,{type:"objectAttribute",value:e}]);continue}if("ObjectSplat"===i.type){let e=eD(i,t);switch(eN("object.splat.result %O",e),e.type){case"object":n.push([o,e]);continue;case"union":for(let t of e.of)if("unknown"===t.type)return t;n.push([o,e]);continue;default:return{type:"unknown"}}}if("ObjectConditionalSplat"===i.type){let e=eB(eU({node:i.condition,scope:t}),t);if(eN("object.conditional.splat.condition %O",e),!1===e.canBeTrue)continue;let r=eD(i,t);if(eN("object.conditional.splat.result %O",r),!1===e.canBeFalse&&!1===e.canBeNull)switch(r.type){case"object":n.push([o,r]);continue;case"union":for(let e of r.of)if("object"!==e.type)return{type:"unknown"};n.push([o,r]);continue;default:return{type:"unknown"}}let s=eP(r,t,e=>(eN("object.conditional.splat.result.concrete %O",e),"object"!==e.type?{type:"unknown"}:{type:"object",attributes:e.attributes}));if("union"===s.type){for(let e of s.of)if("object"!==e.type)return{type:"unknown"};s.of.push({type:"object",attributes:{}}),a.push([o,s]);continue}if("object"!==s.type)return{type:"unknown"};a.push([o,{type:"union",of:[{type:"object",attributes:{}},s]}]);continue}throw Error(`Unknown object attribute type: ${i.type}`)}let o=[];for(let[e,t]of(o.push(...r),n)){if("object"===t.type){for(let r in t.attributes){if(!t.attributes.hasOwnProperty(r))continue;let n=t.attributes[r];o.push([e,r,n])}continue}a.push([e,t])}if(o.sort(([e],[t])=>e-t),0===a.length)return{type:"object",attributes:Object.fromEntries(o.map(([,e,t])=>[e,t]))};let i=[];for(let[e,t]of a){let r=[],n=[];for(let[t,a,i]of o)t<e&&r.push([t,a,i]),t>e&&n.push([t,a,i]);let s=[];for(let[e,t]of a){let r=[];for(let e of t.of)r.push(e.attributes);s.push([e,r])}for(let a of t.of)for(let[t,o]of(i.push({type:"object",attributes:{...Object.fromEntries(r.map(([,e,t])=>[e,t])),...a.attributes,...Object.fromEntries(n.map(([,e,t])=>[e,t]))}}),s))for(let u of o)for(let[o,l]of s)if(t!==o)for(let s of l){let l=[...r],c=[...n];for(let r in u)u.hasOwnProperty(r)&&t!==e&&(t<e&&l.push([t,r,u[r]]),t>e&&c.push([t,r,u[r]]));for(let r in s)s.hasOwnProperty(r)&&t!==e&&(o<e&&l.push([o,r,s[r]]),o>e&&c.push([o,r,s[r]]));l.sort(([e],[t])=>e-t),c.sort(([e],[t])=>e-t);let p=Object.fromEntries(l.map(([,e,t])=>[e,t])),y=Object.fromEntries(c.map(([,e,t])=>[e,t]));i.push({type:"object",attributes:{...p,...a.attributes,...y}})}}return eS({type:"union",of:i})}(e,t);case"Value":if(null===e.value)return{type:"null"};switch(typeof e.value){case"string":return{type:"string",value:e.value};case"number":return{type:"number",value:e.value};case"boolean":return{type:"boolean",value:e.value};case"object":return null===e.value?{type:"null"}:Array.isArray(e.value)?{type:"array",of:{type:"union",of:e.value.map(e=>eU({node:{type:"Value",value:e},scope:t}))}}:{type:"object",attributes:Object.fromEntries(Object.entries(e.value).map(([e,r])=>[e,{type:"objectAttribute",value:eU({node:{type:"Value",value:r},scope:t})}]))};default:return{type:"unknown"}}case"Array":let v=[];for(let r of e.elements){let e=eU({node:r.value,scope:t});null!==e&&v.push(e)}return{type:"array",of:{type:"union",of:v}};case"Everything":return{type:"array",of:{type:"union",of:t.context.schema.filter(e=>"document"===e.type).map(e=>({type:"object",attributes:e.attributes}))}};case"This":return eN("this %O",t.value),t.value;case"Parent":return function({n:e},t){eN("handle.parent.currentScope %d %O",e,t);let r=t;for(let t=0;t<e;t++){for(;r?.isHidden;)r=r.parent;r=r?.parent}return eN("handle.parent.newScope %d %O",e,r),r?0===r.value.of.length?{type:"null"}:r.value:{type:"null"}}(e,t);case"FuncCall":return function(e,t){switch(`${e.namespace}.${e.name}`){case"array.compact":return eP(eU({node:e.args[0],scope:t}),t,e=>"unknown"===e.type?eF({type:"array",of:{type:"unknown"}}):"array"!==e.type?{type:"null"}:{type:"array",of:e$(eP(e.of,t,e=>e))});case"array.join":{let r=eU({node:e.args[0],scope:t}),n=eU({node:e.args[1],scope:t});return eP(r,t,e=>eP(n,t,r=>"unknown"===e.type||"unknown"===r.type?eF({type:"string"}):"array"!==e.type||"string"!==r.type?{type:"null"}:eP(e.of,t,e=>"unknown"===e.type?eF({type:"string"}):"string"!==e.type&&"number"!==e.type&&"boolean"!==e.type?{type:"null"}:{type:"string"})))}case"array.unique":return eP(eU({node:e.args[0],scope:t}),t,e=>"unknown"===e.type?eF({type:"array",of:{type:"unknown"}}):"array"!==e.type?{type:"null"}:e);case"array.intersects":{let r=eU({node:e.args[0],scope:t}),n=eU({node:e.args[1],scope:t});return eP(r,t,e=>eP(n,t,t=>"array"!==e.type||"array"!==t.type?{type:"null"}:{type:"boolean"}))}case"global.lower":return eP(eU({node:e.args[0],scope:t}),t,e=>"unknown"===e.type?eF({type:"string"}):"string"!==e.type?{type:"null"}:void 0!==e.value?{type:"string",value:e.value.toLowerCase()}:{type:"string"});case"global.upper":return eP(eU({node:e.args[0],scope:t}),t,e=>"unknown"===e.type?eF({type:"string"}):"string"!==e.type?{type:"null"}:void 0!==e.value?{type:"string",value:e.value.toUpperCase()}:{type:"string"});case"dateTime.now":case"global.now":return{type:"string"};case"global.defined":return eP(eU({node:e.args[0],scope:t}),t,e=>"unknown"===e.type?{type:"boolean"}:{type:"boolean",value:"null"!==e.type});case"global.path":return eP(eU({node:e.args[0],scope:t}),t,e=>"unknown"===e.type?eF({type:"string"}):"string"===e.type?{type:"string"}:{type:"null"});case"global.coalesce":{if(0===e.args.length)return{type:"null"};let r=[],n=!0;for(let a of e.args){let e=eS(eU({node:a,scope:t})),o="null"===e.type||"union"===e.type&&e.of.every(e=>"null"===e.type);if(n=o||"unknown"===e.type||"union"===e.type&&e.of.some(e=>"null"===e.type||"unknown"===e.type),o||r.push(e$(e)),!n)break}return n&&r.push({type:"null"}),{type:"union",of:r}}case"global.count":return eP(eU({node:e.args[0],scope:t}),t,e=>"unknown"===e.type?eF({type:"string"}):"array"===e.type?{type:"number"}:{type:"null"});case"global.dateTime":return eP(eU({node:e.args[0],scope:t}),t,e=>"unknown"===e.type||"string"===e.type?eF({type:"string"}):{type:"null"});case"global.length":return eP(eU({node:e.args[0],scope:t}),t,e=>"unknown"===e.type?eF({type:"number"}):"array"===e.type||"string"===e.type?{type:"number"}:{type:"null"});case"global.references":return{type:"boolean"};case"global.round":return eP(eU({node:e.args[0],scope:t}),t,r=>"unknown"===r.type?eF({type:"number"}):"number"!==r.type?{type:"null"}:2===e.args.length?eP(eU({node:e.args[1],scope:t}),t,e=>"unknown"===e.type?eF({type:"number"}):"number"!==e.type?{type:"null"}:{type:"number"}):{type:"number"});case"global.string":return eP(eU({node:e.args[0],scope:t}),t,e=>"unknown"===e.type?eF({type:"string"}):"string"===e.type||"number"===e.type||"boolean"===e.type?e.value?{type:"string",value:e.value.toString()}:{type:"string"}:{type:"null"});case"math.sum":return eP(eU({node:e.args[0],scope:t}),t,e=>"unknown"===e.type?eF({type:"number"}):"array"!==e.type?{type:"null"}:eP(e.of,t,e=>"unknown"===e.type?eF({type:"number"}):"number"===e.type||"null"===e.type?{type:"number"}:{type:"null"}));case"math.avg":return eP(eU({node:e.args[0],scope:t}),t,e=>"unknown"===e.type?eF({type:"number"}):"array"!==e.type?{type:"null"}:eP(e.of,t,e=>"unknown"===e.type?eF({type:"number"}):"number"===e.type?{type:"number"}:{type:"null"}));case"math.max":case"math.min":return eP(eU({node:e.args[0],scope:t}),t,e=>"unknown"===e.type?eF({type:"number"}):"array"!==e.type?{type:"null"}:eP(e.of,t,e=>"unknown"===e.type?eF({type:"number"}):"number"===e.type?e:{type:"null"}));case"pt.text":return 0===e.args.length?{type:"null"}:{type:"string"};case"string.startsWith":{let r=eU({node:e.args[0],scope:t}),n=eU({node:e.args[1],scope:t});return eP(r,t,e=>eP(n,t,t=>"unknown"===e.type||"unknown"===t.type?eF({type:"boolean"}):"string"!==e.type||"string"!==t.type?{type:"null"}:{type:"boolean"}))}case"string.split":{let r=eU({node:e.args[0],scope:t}),n=eU({node:e.args[1],scope:t});return eP(r,t,e=>eP(n,t,t=>"unknown"===e.type||"unknown"===t.type?eF({type:"array",of:{type:"string"}}):"string"!==e.type||"string"!==t.type?{type:"null"}:{type:"array",of:{type:"string"}}))}case"sanity.versionOf":return eP(eU({node:e.args[0],scope:t}),t,e=>"unknown"===e.type?eF({type:"boolean"}):"string"!==e.type?{type:"null"}:{type:"boolean"});case"sanity.partOfRelease":return eP(eU({node:e.args[0],scope:t}),t,e=>"unknown"===e.type?eF({type:"boolean"}):"string"!==e.type?{type:"null"}:{type:"boolean"});default:return{type:"unknown"}}}(e,t);case"Not":return eP(eU({node:e.base,scope:t}),t,e=>"unknown"===e.type?eF({type:"boolean"}):"boolean"===e.type?void 0!==e.value?{type:"boolean",value:!1===e.value}:{type:"boolean"}:{type:"null"});case"Parameter":case"Asc":case"Desc":case"Context":case"Tuple":case"Selector":case"InRange":return{type:"unknown"};case"Slice":return eN("slice.node %O",e),eL(eU({node:e.base,scope:t}),t,e=>e);case"Neg":return eP(eU({node:e.base,scope:t}),t,e=>"unknown"===e.type?eF({type:"number"}):"number"!==e.type?{type:"null"}:void 0!==e.value?{type:"number",value:-e.value}:e);case"Pos":return eP(eU({node:e.base,scope:t}),t,e=>"unknown"===e.type?eF({type:"number"}):"number"!==e.type?{type:"null"}:e);default:throw Error(`unknown node type ${e.type}`)}}function eG(e){return"string"===e.type||"number"===e.type||"boolean"===e.type}function eq(e,t,r){if(void 0!==t.value&&void 0!==r.value)switch(e){case"==":return t.value===r.value;case"<":return t.value<r.value;case"<=":return t.value<=r.value;case">":return t.value>r.value;case">=":return t.value>=r.value;default:throw Error(`unknown comparison operator ${e}`)}}function eH(e,t){eN("resolveFilter.expr %O",e);let r=t.value.of.filter(r=>{let n=t.createHidden([r]);return eB(eU({node:e,scope:n}),n).canBeTrue});return eN(`resolveFilter ${"OpCall"===e.type?`${e.type}/${e.op}`:e.type} %O`,r),{type:"union",of:r}}function eL(e,t,r){return eP(e,t,e=>"unknown"===e.type?e:"array"===e.type?r(e):{type:"null"})}function eW(e,t,r){return eP(e,t,e=>"unknown"===e.type?e:"object"===e.type?r(e):{type:"null"})}t.DateTime=y,t.Path=a,t.createReferenceTypeNode=function(e,t=!1){let r={_ref:{type:"objectAttribute",value:{type:"string"}},_type:{type:"objectAttribute",value:{type:"string",value:"reference"}},_weak:{type:"objectAttribute",value:{type:"boolean"},optional:!0}};return t&&(r._key={type:"objectAttribute",value:{type:"string"}}),{type:"object",attributes:r,dereferencesTo:e}},t.evaluate=function(e,t={}){let r=b(t.root),n=b(t.dataset);return B(e,new P({...t.params},n,r,{timestamp:t.timestamp||new Date,identity:void 0===t.identity?"me":t.identity,sanity:t.sanity,after:t.after?b(t.after):null,before:t.before?b(t.before):null,dereference:t.dereference},null))},t.parse=function(e,t={}){let r,n,a=(r=0,r=el(e,0),"error"===(n=eo(e,r,0)).type?n:(r=el(e,n.position))!==e.length?(n.failPosition&&(r=n.failPosition-1),{type:"error",position:r}):(delete n.position,delete n.failPosition,n));if("error"===a.type)throw new ej(a.position);return new et(e,a.marks,t).process(em)},t.typeEvaluate=function(e,t){eR("evaluateQueryType.ast %O",e),eR("evaluateQueryType.schema %O",t);let r=eU({node:e,scope:new eI([],void 0,new eT(t))});eN("evaluateQueryType.parsed %O",r);let n=eS(r);return eR("evaluateQueryType.optimized %O",n),n}},8239:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(5804);t.DateTime=n.DateTime,t.Path=n.Path,t.createReferenceTypeNode=n.createReferenceTypeNode,t.evaluate=n.evaluate,t.parse=n.parse,t.typeEvaluate=n.typeEvaluate},9630:(e,t,r)=>{e.exports=function(e){function t(e){let r,a,o,i=null;function s(...e){if(!s.enabled)return;let n=Number(new Date);s.diff=n-(r||n),s.prev=r,s.curr=n,r=n,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,n)=>{if("%%"===r)return"%";a++;let o=t.formatters[n];if("function"==typeof o){let t=e[a];r=o.call(s,t),e.splice(a,1),a--}return r}),t.formatArgs.call(s,e),(s.log||t.log).apply(s,e)}return s.namespace=e,s.useColors=t.useColors(),s.color=t.selectColor(e),s.extend=n,s.destroy=t.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==i?i:(a!==t.namespaces&&(a=t.namespaces,o=t.enabled(e)),o),set:e=>{i=e}}),"function"==typeof t.init&&t.init(s),s}function n(e,r){let n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function a(e,t){let r=0,n=0,a=-1,o=0;for(;r<e.length;)if(n<t.length&&(t[n]===e[r]||"*"===t[n]))"*"===t[n]?(a=n,o=r):r++,n++;else{if(-1===a)return!1;n=a+1,r=++o}for(;n<t.length&&"*"===t[n];)n++;return n===t.length}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){let e=[...t.names,...t.skips.map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){for(let r of(t.save(e),t.namespaces=e,t.names=[],t.skips=[],("string"==typeof e?e:"").trim().replace(/\s+/g,",").split(",").filter(Boolean)))"-"===r[0]?t.skips.push(r.slice(1)):t.names.push(r)},t.enabled=function(e){for(let r of t.skips)if(a(e,r))return!1;for(let r of t.names)if(a(e,r))return!0;return!1},t.humanize=r(3139),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(r=>{t[r]=e[r]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t)|0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}}}]);